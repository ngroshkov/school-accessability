colnames(aa)
colnames(aa)[2]
colnames(aa)[2] <- "STEP1_2015"
colnames(aa)[3] <- "STEP2_2015"
colnames(aa)[4] <- "STEP3_2015"
compl <- merge(complexes, aa, by="ID")
colnames(compl)
compl <- compl[c(1:9,15,10,16,11,17,12,13,14)]
compl$STUDENTS_2015 <- compl$STEP1_2015 + compl$STEP2_2015 + compl$STEP3_2015
compl$STUDENTS_PER_SCHOOL_2015 <- compl$STUDENTS_2015/compl$SCHOOLS_COUNT
colnames(compl)
compl <- compl[c(1:15,18,16,19,17)]
colnames(compl)
View(compl)
complexes <- compl
rm(aa, compl)
save.image()
savehistory()
write.csv(x = complexes, file = "../csv/model/complexes.csv", row.names = FALSE, na = "")
write.csv(x = schools, file = "../csv/model/schools.csv", row.names = FALSE, na = "")
write.csv(x = school2building.catchment.complex, file = "../csv/school2building/school2building.catchment.complex.csv", row.names = FALSE, na = "")
save.image()
features.connection.catchment.complex <- generate.connection.features(buildings, schools, school.blocks, school2building.catchment.complex)
library("geosphere", lib.loc="~/R/i686-pc-linux-gnu-library/3.0")
features.connection.catchment.complex <- generate.connection.features(buildings, schools, school.blocks, school2building.catchment.complex)
write.csv(features.connection.catchment.complex, "../csv/features/features.connection.catchment.complex.csv", row.names = FALSE)
features.area.catchment.complex <- generate.area.features(buildings, schools, school.blocks, school2building.catchment.complex)
write.csv(features.area.catchment.complex, "../csv/features/features.area.catchment.complex.csv", row.names = FALSE)
save.image()
colnames(complexes)
sch <- merge(schools, complexes[1,17,18], by.x = "COMPLEX_ID", by.y = "ID", all.x = TRUE);
sch <- merge(schools, complexes[c(1,17,18)], by.x = "COMPLEX_ID", by.y = "ID", all.x = TRUE);
colnames(schools)
colnames(sch)
sch <- sch[c(2:9,1,10,15,16,12,13,14)]
colnames(sch)
colnames(sch)[11]
colnames(sch)[11] <- "STUDENTS_2014"
colnames(sch)[12] <- "STUDENTS_2015"
colnames(sch)
schools <- sch
rm(sch)
schools$ID <- is.integer(schools$ID)
schools$NUMB <- is.integer(schools$NUMB)
savehistory()
Sys.setlocale("LC_CTYPE", "ru_RU.UTF-8")
View(schools)
sch <- merge(schools, complexes[1,17,18], by.x = "COMPLEX_ID", by.y = "ID", all.x = TRUE);
sch <- merge(schools, complexes[c(1,17,18)], by.x = "COMPLEX_ID", by.y = "ID", all.x = TRUE);
sch <- sch[c(2:9,1,10,15,16,12,13,14)]
colnames(sch)[11] <- "STUDENTS_2014"
colnames(sch)[12] <- "STUDENTS_2015"
colnames(sch)
schools <- sch
rm(sch)
save.image()
schools$ID <- as.integer(schools$ID)
schools$NUMB <- as.integer(schools$NUMB)
schools$CLOSED <- schools$CLOSED == 1
View(schools)
schools$COMPLEX_ID <- as.integer(schools$COMPLEX_ID)
schools$RATING <- as.integer(schools$RATING)
schools$STUDENTS_2014 <- round(schools$STUDENTS_2014)
schools$STUDENTS_2015 <- round(schools$STUDENTS_2015)
View(schools)
schools$STUDENTS_PROJECT_CATCHMENT <- round(schools$STUDENTS_PROJECT_CATCHMENT)
schools$STUDENTS_PROJECT_COMPLEX <- round(schools$STUDENTS_PROJECT_COMPLEX)
schools$STUDENTS_PROJECT_SNIP <- round(schools$STUDENTS_PROJECT_SNIP)
schools$STUDENTS_2014 <- as.integer(schools$STUDENTS_2014)
schools$STUDENTS_2015 <- as.integer(schools$STUDENTS_2015)
schools$STUDENTS_PROJECT_CATCHMENT <- as.integer(schools$STUDENTS_PROJECT_CATCHMENT)
schools$STUDENTS_PROJECT_COMPLEX <- as.integer(schools$STUDENTS_PROJECT_COMPLEX)
schools$STUDENTS_PROJECT_SNIP <- as.integer(schools$STUDENTS_PROJECT_SNIP)
write.csv(x = schools, file = "../csv/model/schools.csv", row.names = FALSE, na = "")
save.image()
savehistory()
View(buildings)
buildings$ACCESSIBLE_SCHOOLS_RESDISTRICT <- as.integer(buildings$ACCESSIBLE_SCHOOLS_RESDISTRICT)
buildings$ACCESSIBLE_SCHOOLS_SNIP <- as.integer(buildings$ACCESSIBLE_SCHOOLS_SNIP)
comment(buildings$ACCESSIBLE_SCHOOLS_SNIP) <- "Выбор школ по СНиПам"
comment(buildings$ACCESSIBLE_SCHOOLS_RESDISTRICT) <- "Выбор школ в рамках жилого района"
save.image()
savehistory()
colnames(buildings)
comment(buildings$ACCESSIBLE_SCHOOLS_R500) <- "Выбор школ в радиусе 500 м"
comment(buildings$ACCESSIBLE_SCHOOLS_R800) <- "Выбор школ в радиусе 800 м"
comment(buildings$ACCESSIBLE_SCHOOLS_R1000) <- "Выбор школ в радиусе 1000 м"
comment(buildings$ACCESSIBLE_SCHOOLS_AREA) <- "Выбор школ в рамках закрепленной территории"
comment(buildings$ACCESSIBLE_SCHOOLS_COMPLEX) <- "Выбор школ в рамках закрепленной территории и комплекса"
save.image()
savehistory()
comment(schools$STUDENTS_2014) <- "Реальная заполняемость школ (2014г.)"
comment(schools$STUDENTS_2015) <- "Реальная заполняемость школ (2015г.)"
comment(schools$STUDENTS_PROJECT_SNIP) <- "Проектная заполняемость школ по СНиПам"
comment(schools$STUDENTS_PROJECT_CATCHMENT) <- "Проектная заполняемость школ\nпо закрепленной территории"
comment(schools$STUDENTS_PROJECT_COMPLEX) <- "Проектная заполняемость школ\nпо закрепленной территории и комплексу"
save.image()
savehistory()
View(complexes)
complexes$SCHOOLS_COUNT <- as.integer(complexes$SCHOOLS_COUNT)
complexes$STEP1_2014 <- as.integer(complexes$STEP1_2014)
complexes$STEP2_2014 <- as.integer(complexes$STEP2_2014)
complexes$STEP3_2014 <- as.integer(complexes$STEP3_2014)
complexes$STUDENTS_2014 <- as.integer(complexes$STUDENTS_2014)
complexes$STUDENTS_PER_SCHOOL_2014 <- as.integer(complexes$STUDENTS_PER_SCHOOL_2014)
complexes$STUDENTS_PER_SCHOOL_2015 <- as.integer(complexes$STUDENTS_PER_SCHOOL_2015)
save.image()
savehistory()
school2building.catchment.complex$SCHOOL_ID <- as.integer(school2building.catchment.complex$SCHOOL_ID)
school2building.catchment.complex$COMPLEX_ID <- as.integer(school2building.catchment.complex$COMPLEX_ID)
school2building.catchment.complex.old$SCHOOL_ID <- as.integer(school2building.catchment.complex.old$SCHOOL_ID)
save.image()
savehistory()
rm(b, BUILDING_ID)
rm(complex.size())
rm(complex.size
)
freqhist.economic(schools[schools$STUDENTS_2014 != 0,], "STUDENTS_2014")
freqhist.economic  <- function(schools, field) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
scale_y_continuous(name="Количество школ\n", breaks=seq(0, 600, by = 50), limits=c(0, 700)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools[schools$STUDENTS_2014 != 0,], "STUDENTS_2014")
freqhist.economic  <- function(schools, field) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
scale_y_continuous(name="Количество школ\n", breaks=seq(0, 700, by = 50), limits=c(0, 700)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools[schools$STUDENTS_2014 != 0,], "STUDENTS_2014")
freqhist.economic  <- function(schools, field) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
#scale_y_continuous(name="Количество школ\n", breaks=seq(0, 700, by = 50), limits=c(0, 700)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools[schools$STUDENTS_2014 != 0,], "STUDENTS_2014")
freqhist.economic  <- function(schools, field) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
scale_y_continuous(name="Количество школ\n", breaks=seq(0, 750, by = 50), limits=c(0, 760)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools[schools$STUDENTS_2014 != 0,], "STUDENTS_2014")
freqhist.economic  <- function(schools, field) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
scale_y_continuous(name="Количество школ\n", breaks=seq(0, 750, by = 50), limits=c(0, 770)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools[schools$STUDENTS_2014 != 0,], "STUDENTS_2014")
schools.n <- schools[schools$STUDENTS_2014 != 0,];
comment(schools)
comment(schools.n$STUDENTS_2014) <- "Реальная заполняемость школ (2014г.)"
comment(schools.n$STUDENTS_2015) <- "Реальная заполняемость школ (2015г.)"
freqhist.economic(schools.n, "STUDENTS_2014")
freqhist.economic  <- function(schools, field) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
scale_y_continuous(name="Количество школ\n", breaks=seq(0, 750, by = 50), limits=c(0, 790)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools.n, "STUDENTS_2014")
freqhist.economic  <- function(schools, field) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
scale_y_continuous(name="Количество школ\n", breaks=seq(0, 750, by = 100), limits=c(0, 800)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools.n, "STUDENTS_2014")
freqhist.economic(schools.n, "STUDENTS_2015")
freqhist.economic(schools.n, "STUDENTS_2014")
freqhist.economic(schools.n, "STUDENTS_2015")
freqhist.economic(schools.n, "STUDENTS_2014")
freqhist.economic  <- function(schools, field) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
colors <- data.frame(ID=as.factor(labels), COLOR = colors);
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
colors <- colors[colors$ID %in% unique(schools$STUDENTS_FACTOR),]
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
scale_y_continuous(name="Количество школ\n", breaks=seq(0, 750, by = 100), limits=c(0, 800)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools.n, "STUDENTS_2014")
freqhist.economic(schools.n, "STUDENTS_2015")
freqhist.economic  <- function(schools, field) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
colors <- data.frame(ID=as.factor(labels), COLOR = colors);
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
colors <- colors[colors$ID %in% unique(schools$STUDENTS_FACTOR),]
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
#scale_y_continuous(name="Количество школ\n", breaks=seq(0, 750, by = 100), limits=c(0, 800)) +
#scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools.n, "STUDENTS_2015")
freqhist.economic(schools.n, "STUDENTS_2014")
schools.n <- schools[schools$STUDENTS_2015 != 0,];
comment(schools.n$STUDENTS_2014) <- "Реальная заполняемость школ (2014г.)"
comment(schools.n$STUDENTS_2015) <- "Реальная заполняемость школ (2015г.)"
freqhist.economic(schools.n, "STUDENTS_2015")
freqhist.economic(schools.n, "STUDENTS_2014")
schools.n <- schools.n[schools.n$STUDENTS_2014 != 0,];
schools.n <- schools.n[schools.n$STUDENTS_2015 != 0,];
comment(schools.n$STUDENTS_2014) <- "Реальная заполняемость школ (2014г.)"
comment(schools.n$STUDENTS_2015) <- "Реальная заполняемость школ (2015г.)"
freqhist.economic(schools.n, "STUDENTS_2014")
freqhist.economic(schools.n, "STUDENTS_2015")
freqhist.economic  <- function(schools, field) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
colors <- data.frame(ID=as.factor(labels), COLOR = colors);
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
colors <- colors[colors$ID %in% unique(schools.to.graph$STUDENTS_FACTOR),]
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
#scale_y_continuous(name="Количество школ\n", breaks=seq(0, 750, by = 100), limits=c(0, 800)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools.n, "STUDENTS_2015")
debugSource('/media/WORK/hse/school-accessibility/r/economic.R')
freqhist.economic(schools.n, "STUDENTS_2015")
debugSource('/media/WORK/hse/school-accessibility/r/economic.R')
freqhist.economic(schools.n, "STUDENTS_2015")
debugSource('/media/WORK/hse/school-accessibility/r/economic.R')
freqhist.economic  <- function(schools, field) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
colors <- data.frame(ID=labels, COLOR = colors);
colors <- as.character(colors$ID);
colors <- as.character(colors$COLOR);
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
colors <- colors[colors$ID %in% unique(as.character(schools.to.graph$STUDENTS_FACTOR)),]
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
#scale_y_continuous(name="Количество школ\n", breaks=seq(0, 750, by = 100), limits=c(0, 800)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools.n, "STUDENTS_2015")
freqhist.economic  <- function(schools, field) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
colors <- data.frame(ID=labels, COLOR = colors);
colors$ID <- as.character(colors$ID);
colors$COLOR <- as.character(colors$COLOR);
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
colors <- colors[colors$ID %in% unique(as.character(schools.to.graph$STUDENTS_FACTOR)),]
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
#scale_y_continuous(name="Количество школ\n", breaks=seq(0, 750, by = 100), limits=c(0, 800)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools.n, "STUDENTS_2015")
debugSource('/media/WORK/hse/school-accessibility/r/economic.R')
freqhist.economic(schools.n, "STUDENTS_2015")
schools.to.graph$STUDENTS_FACTOR
as.character(schools.to.graph$STUDENTS_FACTOR)
unique(as.character(schools.to.graph$STUDENTS_FACTOR))
colors[colors$ID %in% unique(as.character(schools.to.graph$STUDENTS_FACTOR)),]
debugSource('/media/WORK/hse/school-accessibility/r/economic.R')
freqhist.economic  <- function(schools, field) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
colors <- data.frame(ID=labels, COLOR = colors);
colors$ID <- as.character(colors$ID);
colors$COLOR <- as.character(colors$COLOR);
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
colors <- colors[colors$ID %in% unique(as.character(schools.to.graph$STUDENTS_FACTOR)),]
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
#scale_y_continuous(name="Количество школ\n", breaks=seq(0, 750, by = 100), limits=c(0, 800)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors$COLOR) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools.n, "STUDENTS_2015")
freqhist.economic(schools.n, "STUDENTS_2016")
colnames(schools)
freqhist.economic(schools, "STUDENTS_PROJECT_CATCHMENT")
freqhist.economic(schools, "STUDENTS_PROJECT_COMPLEX")
freqhist.economic(schools, "STUDENTS_PROJECT_SNIP")
schools.n <- schools.n[!is.na(schools.n$STUDENTS_2014),];
schools.n <- schools.n[!is.na(schools.n$STUDENTS_2015),];
freqhist.economic(schools.n, "STUDENTS_2015")
freqhist.economic(schools.n, "STUDENTS_2016")
freqhist.economic(schools.n, "STUDENTS_2014")
freqhist.economic(schools.n, "STUDENTS_2015")
comment(schools$STUDENTS_PROJECT_CATCHMENT)
freqhist.economic  <- function(schools, field, include.zero = TRUE) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
colors <- data.frame(ID=labels, COLOR = colors);
colors$ID <- as.character(colors$ID);
colors$COLOR <- as.character(colors$COLOR);
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
if (!include.zero) {
schools.to.graph <- schools.to.graph[schools.to.graph[[field]] != 0,]
}
colors <- colors[colors$ID %in% unique(as.character(schools.to.graph$STUDENTS_FACTOR)),]
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
#scale_y_continuous(name="Количество школ\n", breaks=seq(0, 750, by = 100), limits=c(0, 800)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors$COLOR) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools, "STUDENTS_2015")
freqhist.economic(schools, "STUDENTS_2014")
freqhist.economic(schools, "STUDENTS_2014", FALSE)
freqhist.economic(schools, "STUDENTS_2015", FALSE)
rm(schools.n)
save.image()
savehistory()
freqhist.economic  <- function(schools, field, include.zero = TRUE) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
colors <- data.frame(ID=labels, COLOR = colors);
colors$ID <- as.character(colors$ID);
colors$COLOR <- as.character(colors$COLOR);
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
if (!include.zero) {
schools.to.graph <- schools.to.graph[schools.to.graph[[field]] != 0,]
}
colors <- colors[colors$ID %in% unique(as.character(schools.to.graph$STUDENTS_FACTOR)),]
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
scale_y_continuous(name="Количество школ\n", breaks=seq(0, 750, by = 100), limits=c(0, 800)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors$COLOR) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools, "STUDENTS_2015", FALSE)
freqhist.economic(schools, "STUDENTS_2014", FALSE)
source('/media/WORK/hse/school-accessibility/r/economic.R')
freqhist.economic  <- function(schools, field, include.zero = TRUE) {
colors <- c("#730000", "#e60000", "#55ff00", "#38a800", "#1b5000");
labels <- c("0", "0-500", "500-800", "800-1000", ">1000");
colors <- data.frame(ID=labels, COLOR = colors);
colors$ID <- as.character(colors$ID);
colors$COLOR <- as.character(colors$COLOR);
schools$STUDENTS_FACTOR <- cut(schools[[field]],
breaks=c(-1, 0, 500, 800, 1000, 10000),
labels=labels);
schools.to.graph <- schools[!is.na(schools[[field]]),];
if (!include.zero) {
schools.to.graph <- schools.to.graph[schools.to.graph[[field]] != 0,]
}
colors <- colors[colors$ID %in% unique(as.character(schools.to.graph$STUDENTS_FACTOR)),]
freqhist.economic <- ggplot(schools.to.graph, aes(x = STUDENTS_FACTOR)) +
geom_histogram(aes(fill=STUDENTS_FACTOR), binwidth = 1) +
scale_x_discrete(name="\nСреднее число обучающихся в школе", labels=labels, breaks = labels, limits= labels) +
scale_y_continuous(name="Количество школ\n", breaks=seq(0, 800, by = 100), limits=c(0, 810)) +
scale_fill_manual("", breaks=levels(schools.to.graph$STUDENTS_FACTOR), values=colors$COLOR) +
stat_bin(binwidth=1, geom="text", aes(label=(..count..)), size=3.5, colour="#4C4646", fontface="bold", vjust=-0.5) +
theme(legend.position="none") +
ggtitle(comment(schools[[field]]));
freqhist.economic;
}
freqhist.economic(schools, "STUDENTS_2014", FALSE)
freqhist.economic(schools, "STUDENTS_2015", FALSE)
freqhist.economic(schools, "STUDENTS_PROJECT_SNIP")
freqhist.economic(schools, "STUDENTS_PROJECT_COMPLEX")
freqhist.economic(schools, "STUDENTS_PROJECT_CATCHMENT")
save.image()
savehistory()
freqhist.economic(schools, "STUDENTS_PROJECT_SNIP")
freqhist.economic(schools, "STUDENTS_PROJECT_CATCHMENT")
freqhist.economic(schools, "STUDENTS_PROJECT_COMPLEX")
freqhist.economic(schools, "STUDENTS_2014", FALSE)
freqhist.economic(schools, "STUDENTS_2015", FALSE)
save.image()
savehistory()
