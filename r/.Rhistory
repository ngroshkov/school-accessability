data.frame(SCHOOL_ID = schs, SCHOOL_BLOCK_ID = s.blks, FEATURE_ID = featureIds, POINT_X = pointXs, POINT_Y = pointYs);
generate.area.features <- rbind(generate.area.features, area.features);
}
generate.area.features;
}
school.blocks[school.blocks$SCHOOL_ID==10003,]
school.blocks[school.blocks$SCHOOL_ID==10002,]
schools[schools$ID == 10002,]
area.features <- generate.area.features(buildings, schools[schools$ID == 10002,], school.blocks, school2building.assigned)
View(area.features)
rm(area.features)
save.image()
savehistory()
generate.connection.features <- function(buildings, schools, school.blocks, school2building) {
generate.connection.features <- data.frame();
featureId <- 0;
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
s2b <- school2building[school2building$SCHOOL_ID == sId,];
s2b <- merge(s2b, buildings[buildings$ID %in% s2b$BUILDING_ID,][c(2, 10, 11)], by.x = "BUILDING_ID", by.y = "ID");
s2b$BUILDING_POINT_X <- s2b$POINT_X;
s2b$BUILDING_POINT_Y <- s2b$POINT_Y;
s2b$POINT_X <- NULL;
s2b$POINT_Y <- NULL;
sbs <- school.blocks[school.blocks$SCHOOL_ID == sId,];
school.blocks.ids <- integer();
school.blocks.p_x <- numeric();
school.blocks.p_y <- numeric();
bearings <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
bp <- c(s2b$BUILDING_POINT_X[s2bIdx],s2b$BUILDING_POINT_Y[s2bIdx]);
dists <- integer();
for (sbIdx in 1:nrow(sbs)) {
dist <- distVincentyEllipsoid(bp, c(sbs$POINT_X[sbIdx], sbs$POINT_Y[sbIdx]));
dists <- c(dists, dist);
}
sbs$DIST <- dists;
closestSchoolBlock <- sbs[which(sbs$DIST == min(sbs$DIST)),];
school.blocks.ids <- c(school.blocks.ids, closestSchoolBlock$ID[1]);
school.blocks.p_x <- c(school.blocks.p_x, closestSchoolBlock$POINT_X[1]);
school.blocks.p_y <- c(school.blocks.p_y, closestSchoolBlock$POINT_Y[1]);
bearings <- c(bearings, bearing(c(closestSchoolBlock$POINT_X[1], closestSchoolBlock$POINT_Y[1]), bp));
};
s2b$SCHOOL_BLOCK_ID <- school.blocks.ids;
s2b$SCHOOL_BLOCK_POINT_X <- school.blocks.p_x;
s2b$SCHOOL_BLOCK_POINT_Y <- school.blocks.p_y;
s2b$BEARING <- bearings;
s2b <- s2b[order(s2b$SCHOOL_BLOCK_ID, s2b$BEARING),]
schs <- integer();
s.blks <- integer()
featureIds <- integer();
pointXs <- numeric();
pointYs <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
featureId <- featureId + 1;
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx]);
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$SCHOOL_BLOCK_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$SCHOOL_BLOCK_POINT_Y[s2bIdx]);
}
connection.features <-
data.frame(SCHOOL_ID = schs, SCHOOL_BLOCK_ID = s.blks, FEATURE_ID = featureIds, POINT_X = pointXs, POINT_Y = pointYs);
generate.connection.features <- rbind(generate.connection.features, connection.features);
}
generate.connection.features;
}
generate.area.features <- function(buildings, schools, school.blocks, school2building) {
generate.area.features <- data.frame();
featureId <- 0;
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
s2b <- school2building[school2building$SCHOOL_ID == sId,];
s2b <- merge(s2b, buildings[buildings$ID %in% s2b$BUILDING_ID,][c(2, 10, 11)], by.x = "BUILDING_ID", by.y = "ID");
s2b$BUILDING_POINT_X <- s2b$POINT_X;
s2b$BUILDING_POINT_Y <- s2b$POINT_Y;
s2b$POINT_X <- NULL;
s2b$POINT_Y <- NULL;
sbs <- school.blocks[school.blocks$SCHOOL_ID == sId,];
school.blocks.ids <- integer();
school.blocks.p_x <- numeric();
school.blocks.p_y <- numeric();
bearings <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
bp <- c(s2b$BUILDING_POINT_X[s2bIdx],s2b$BUILDING_POINT_Y[s2bIdx]);
dists <- integer();
for (sbIdx in 1:nrow(sbs)) {
dist <- distVincentyEllipsoid(bp, c(sbs$POINT_X[sbIdx], sbs$POINT_Y[sbIdx]));
dists <- c(dists, dist);
}
sbs$DIST <- dists;
closestSchoolBlock <- sbs[which(sbs$DIST == min(sbs$DIST)),];
school.blocks.ids <- c(school.blocks.ids, closestSchoolBlock$ID[1]);
school.blocks.p_x <- c(school.blocks.p_x, closestSchoolBlock$POINT_X[1]);
school.blocks.p_y <- c(school.blocks.p_y, closestSchoolBlock$POINT_Y[1]);
bearings <- c(bearings, bearing(c(closestSchoolBlock$POINT_X[1], closestSchoolBlock$POINT_Y[1]), bp));
};
s2b$SCHOOL_BLOCK_ID <- school.blocks.ids;
s2b$SCHOOL_BLOCK_POINT_X <- school.blocks.p_x;
s2b$SCHOOL_BLOCK_POINT_Y <- school.blocks.p_y;
s2b$BEARING <- bearings;
s2b <- s2b[order(s2b$SCHOOL_BLOCK_ID, s2b$BEARING),]
schs <- integer();
s.blks <- integer()
featureIds <- integer();
pointXs <- numeric();
pointYs <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
featureId <- featureId + 1;
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx]);
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
if (s2bIdx + 1 > nrow(s2b) | s2b$SCHOOL_BLOCK_ID[s2bIdx] != s2b$SCHOOL_BLOCK_ID[s2bIdx+1]) {
s2b.first <- s2b[s2b$SCHOOL_BLOCK_ID == s2b$SCHOOL_BLOCK_ID[s2bIdx],];
pointXs <- c(pointXs, s2b.first$BUILDING_POINT_X[1]);
pointYs <- c(pointYs, s2b.first$BUILDING_POINT_Y[1]);
} else {
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx+1]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx+1]);
}
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$SCHOOL_BLOCK_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$SCHOOL_BLOCK_POINT_Y[s2bIdx]);
}
area.features <-
data.frame(SCHOOL_ID = schs, SCHOOL_BLOCK_ID = s.blks, FEATURE_ID = featureIds, POINT_X = pointXs, POINT_Y = pointYs);
generate.area.features <- rbind(generate.area.features, area.features);
}
generate.area.features;
}
save.image()
savehistory()
generate.connection.features <- function(buildings, schools, school.blocks, school2building) {
generate.connection.features <- data.frame();
featureId <- 0;
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
s2b <- school2building[school2building$SCHOOL_ID == sId,];
s2b <- merge(s2b, buildings[buildings$ID %in% s2b$BUILDING_ID,][c(2, 10, 11)], by.x = "BUILDING_ID", by.y = "ID");
s2b$BUILDING_POINT_X <- s2b$POINT_X;
s2b$BUILDING_POINT_Y <- s2b$POINT_Y;
s2b$POINT_X <- NULL;
s2b$POINT_Y <- NULL;
sbs <- school.blocks[school.blocks$SCHOOL_ID == sId,];
school.blocks.ids <- integer();
school.blocks.p_x <- numeric();
school.blocks.p_y <- numeric();
bearings <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
bp <- c(s2b$BUILDING_POINT_X[s2bIdx],s2b$BUILDING_POINT_Y[s2bIdx]);
dists <- integer();
for (sbIdx in 1:nrow(sbs)) {
dist <- distVincentyEllipsoid(bp, c(sbs$POINT_X[sbIdx], sbs$POINT_Y[sbIdx]));
dists <- c(dists, dist);
}
sbs$DIST <- dists;
closestSchoolBlock <- sbs[which(sbs$DIST == min(sbs$DIST)),];
school.blocks.ids <- c(school.blocks.ids, closestSchoolBlock$ID[1]);
school.blocks.p_x <- c(school.blocks.p_x, closestSchoolBlock$POINT_X[1]);
school.blocks.p_y <- c(school.blocks.p_y, closestSchoolBlock$POINT_Y[1]);
bearings <- c(bearings, bearing(c(closestSchoolBlock$POINT_X[1], closestSchoolBlock$POINT_Y[1]), bp));
};
s2b$SCHOOL_BLOCK_ID <- school.blocks.ids;
s2b$SCHOOL_BLOCK_POINT_X <- school.blocks.p_x;
s2b$SCHOOL_BLOCK_POINT_Y <- school.blocks.p_y;
s2b$BEARING <- bearings;
s2b <- s2b[order(s2b$SCHOOL_BLOCK_ID, s2b$BEARING),]
schs <- integer();
s.blks <- integer()
featureIds <- integer();
pointXs <- numeric();
pointYs <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
featureId <- featureId + 1;
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx]);
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$SCHOOL_BLOCK_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$SCHOOL_BLOCK_POINT_Y[s2bIdx]);
}
connection.features <-
data.frame(SCHOOL_ID = schs, SCHOOL_BLOCK_ID = s.blks, FEATURE_ID = featureIds, POINT_X = pointXs, POINT_Y = pointYs);
generate.connection.features <- rbind(generate.connection.features, connection.features);
print(paste(sIdx, " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
}
generate.connection.features;
}
generate.area.features <- function(buildings, schools, school.blocks, school2building) {
generate.area.features <- data.frame();
featureId <- 0;
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
s2b <- school2building[school2building$SCHOOL_ID == sId,];
s2b <- merge(s2b, buildings[buildings$ID %in% s2b$BUILDING_ID,][c(2, 10, 11)], by.x = "BUILDING_ID", by.y = "ID");
s2b$BUILDING_POINT_X <- s2b$POINT_X;
s2b$BUILDING_POINT_Y <- s2b$POINT_Y;
s2b$POINT_X <- NULL;
s2b$POINT_Y <- NULL;
sbs <- school.blocks[school.blocks$SCHOOL_ID == sId,];
school.blocks.ids <- integer();
school.blocks.p_x <- numeric();
school.blocks.p_y <- numeric();
bearings <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
bp <- c(s2b$BUILDING_POINT_X[s2bIdx],s2b$BUILDING_POINT_Y[s2bIdx]);
dists <- integer();
for (sbIdx in 1:nrow(sbs)) {
dist <- distVincentyEllipsoid(bp, c(sbs$POINT_X[sbIdx], sbs$POINT_Y[sbIdx]));
dists <- c(dists, dist);
}
sbs$DIST <- dists;
closestSchoolBlock <- sbs[which(sbs$DIST == min(sbs$DIST)),];
school.blocks.ids <- c(school.blocks.ids, closestSchoolBlock$ID[1]);
school.blocks.p_x <- c(school.blocks.p_x, closestSchoolBlock$POINT_X[1]);
school.blocks.p_y <- c(school.blocks.p_y, closestSchoolBlock$POINT_Y[1]);
bearings <- c(bearings, bearing(c(closestSchoolBlock$POINT_X[1], closestSchoolBlock$POINT_Y[1]), bp));
};
s2b$SCHOOL_BLOCK_ID <- school.blocks.ids;
s2b$SCHOOL_BLOCK_POINT_X <- school.blocks.p_x;
s2b$SCHOOL_BLOCK_POINT_Y <- school.blocks.p_y;
s2b$BEARING <- bearings;
s2b <- s2b[order(s2b$SCHOOL_BLOCK_ID, s2b$BEARING),]
schs <- integer();
s.blks <- integer()
featureIds <- integer();
pointXs <- numeric();
pointYs <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
featureId <- featureId + 1;
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx]);
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
if (s2bIdx + 1 > nrow(s2b) | s2b$SCHOOL_BLOCK_ID[s2bIdx] != s2b$SCHOOL_BLOCK_ID[s2bIdx+1]) {
s2b.first <- s2b[s2b$SCHOOL_BLOCK_ID == s2b$SCHOOL_BLOCK_ID[s2bIdx],];
pointXs <- c(pointXs, s2b.first$BUILDING_POINT_X[1]);
pointYs <- c(pointYs, s2b.first$BUILDING_POINT_Y[1]);
} else {
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx+1]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx+1]);
}
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$SCHOOL_BLOCK_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$SCHOOL_BLOCK_POINT_Y[s2bIdx]);
}
area.features <-
data.frame(SCHOOL_ID = schs, SCHOOL_BLOCK_ID = s.blks, FEATURE_ID = featureIds, POINT_X = pointXs, POINT_Y = pointYs);
generate.area.features <- rbind(generate.area.features, area.features);
print(paste(sIdx, " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
}
generate.area.features;
}
save.image()
savehistory()
connection.features.assigned <- generate.connection.features(buildings, schools, school.blocks, school2building)
connection.features.assigned <- generate.connection.features(buildings, schools, school.blocks, school2building.assigned)
debugSource('/media/WORK/hse/school-accessibility/r/generate-features.R')
connection.features.assigned <- generate.connection.features(buildings, schools, school.blocks, school2building.assigned)
debugSource('/media/WORK/hse/school-accessibility/r/generate-features.R')
debugSource('/media/WORK/hse/school-accessibility/r/generate-features.R')
debugSource('/media/WORK/hse/school-accessibility/r/generate-features.R')
generate.connection.features <- function(buildings, schools, school.blocks, school2building) {
generate.connection.features <- data.frame();
featureId <- 0;
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
s2b <- school2building[school2building$SCHOOL_ID == sId,];
if (nrow(s2b) == 0) {
next;
}
s2b <- merge(s2b, buildings[buildings$ID %in% s2b$BUILDING_ID,][c(2, 10, 11)], by.x = "BUILDING_ID", by.y = "ID");
s2b$BUILDING_POINT_X <- s2b$POINT_X;
s2b$BUILDING_POINT_Y <- s2b$POINT_Y;
s2b$POINT_X <- NULL;
s2b$POINT_Y <- NULL;
sbs <- school.blocks[school.blocks$SCHOOL_ID == sId,];
school.blocks.ids <- integer();
school.blocks.p_x <- numeric();
school.blocks.p_y <- numeric();
bearings <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
bp <- c(s2b$BUILDING_POINT_X[s2bIdx],s2b$BUILDING_POINT_Y[s2bIdx]);
dists <- integer();
for (sbIdx in 1:nrow(sbs)) {
dist <- distVincentyEllipsoid(bp, c(sbs$POINT_X[sbIdx], sbs$POINT_Y[sbIdx]));
dists <- c(dists, dist);
}
sbs$DIST <- dists;
closestSchoolBlock <- sbs[which(sbs$DIST == min(sbs$DIST)),];
school.blocks.ids <- c(school.blocks.ids, closestSchoolBlock$ID[1]);
school.blocks.p_x <- c(school.blocks.p_x, closestSchoolBlock$POINT_X[1]);
school.blocks.p_y <- c(school.blocks.p_y, closestSchoolBlock$POINT_Y[1]);
bearings <- c(bearings, bearing(c(closestSchoolBlock$POINT_X[1], closestSchoolBlock$POINT_Y[1]), bp));
};
s2b$SCHOOL_BLOCK_ID <- school.blocks.ids;
s2b$SCHOOL_BLOCK_POINT_X <- school.blocks.p_x;
s2b$SCHOOL_BLOCK_POINT_Y <- school.blocks.p_y;
s2b$BEARING <- bearings;
s2b <- s2b[order(s2b$SCHOOL_BLOCK_ID, s2b$BEARING),]
schs <- integer();
s.blks <- integer()
featureIds <- integer();
pointXs <- numeric();
pointYs <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
featureId <- featureId + 1;
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx]);
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$SCHOOL_BLOCK_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$SCHOOL_BLOCK_POINT_Y[s2bIdx]);
}
connection.features <-
data.frame(SCHOOL_ID = schs, SCHOOL_BLOCK_ID = s.blks, FEATURE_ID = featureIds, POINT_X = pointXs, POINT_Y = pointYs);
generate.connection.features <- rbind(generate.connection.features, connection.features);
print(paste(sIdx, " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
}
generate.connection.features;
}
generate.area.features <- function(buildings, schools, school.blocks, school2building) {
generate.area.features <- data.frame();
featureId <- 0;
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
s2b <- school2building[school2building$SCHOOL_ID == sId,];
if (nrow(s2b) == 0) {
next;
}
s2b <- merge(s2b, buildings[buildings$ID %in% s2b$BUILDING_ID,][c(2, 10, 11)], by.x = "BUILDING_ID", by.y = "ID");
s2b$BUILDING_POINT_X <- s2b$POINT_X;
s2b$BUILDING_POINT_Y <- s2b$POINT_Y;
s2b$POINT_X <- NULL;
s2b$POINT_Y <- NULL;
sbs <- school.blocks[school.blocks$SCHOOL_ID == sId,];
school.blocks.ids <- integer();
school.blocks.p_x <- numeric();
school.blocks.p_y <- numeric();
bearings <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
bp <- c(s2b$BUILDING_POINT_X[s2bIdx],s2b$BUILDING_POINT_Y[s2bIdx]);
dists <- integer();
for (sbIdx in 1:nrow(sbs)) {
dist <- distVincentyEllipsoid(bp, c(sbs$POINT_X[sbIdx], sbs$POINT_Y[sbIdx]));
dists <- c(dists, dist);
}
sbs$DIST <- dists;
closestSchoolBlock <- sbs[which(sbs$DIST == min(sbs$DIST)),];
school.blocks.ids <- c(school.blocks.ids, closestSchoolBlock$ID[1]);
school.blocks.p_x <- c(school.blocks.p_x, closestSchoolBlock$POINT_X[1]);
school.blocks.p_y <- c(school.blocks.p_y, closestSchoolBlock$POINT_Y[1]);
bearings <- c(bearings, bearing(c(closestSchoolBlock$POINT_X[1], closestSchoolBlock$POINT_Y[1]), bp));
};
s2b$SCHOOL_BLOCK_ID <- school.blocks.ids;
s2b$SCHOOL_BLOCK_POINT_X <- school.blocks.p_x;
s2b$SCHOOL_BLOCK_POINT_Y <- school.blocks.p_y;
s2b$BEARING <- bearings;
s2b <- s2b[order(s2b$SCHOOL_BLOCK_ID, s2b$BEARING),]
schs <- integer();
s.blks <- integer()
featureIds <- integer();
pointXs <- numeric();
pointYs <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
featureId <- featureId + 1;
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx]);
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
if (s2bIdx + 1 > nrow(s2b) | s2b$SCHOOL_BLOCK_ID[s2bIdx] != s2b$SCHOOL_BLOCK_ID[s2bIdx+1]) {
s2b.first <- s2b[s2b$SCHOOL_BLOCK_ID == s2b$SCHOOL_BLOCK_ID[s2bIdx],];
pointXs <- c(pointXs, s2b.first$BUILDING_POINT_X[1]);
pointYs <- c(pointYs, s2b.first$BUILDING_POINT_Y[1]);
} else {
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx+1]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx+1]);
}
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$SCHOOL_BLOCK_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$SCHOOL_BLOCK_POINT_Y[s2bIdx]);
}
area.features <-
data.frame(SCHOOL_ID = schs, SCHOOL_BLOCK_ID = s.blks, FEATURE_ID = featureIds, POINT_X = pointXs, POINT_Y = pointYs);
generate.area.features <- rbind(generate.area.features, area.features);
print(paste(sIdx, " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
}
generate.area.features;
}
save.image()
savehistory()
connection.features.assigned <- generate.connection.features(buildings, schools, school.blocks, school2building.assigned)
View(connection.features.assigned)
save.image()
area.features.assigned <- generate.area.features(buildings, schools, school.blocks, school2building.assigned)
features.area.assigned <- area.features.assigned
features.connection.assigned <- connection.features.assigned
rm(area.features.assigned, connection.features.assigned)
save.image()
savehistory()
features.connection.economic <- generate.connection.features(buildings, schools, school.blocks, school2building.economic)
save.image()
savehistory()
features.area.economic <- generate.area.features(buildings, schools, school.blocks, school2building.economic)
save.image()
savehistory()
write.csv(features.area.assigned, "../csv/features.area.assigned.csv", row.names = FALSE)
write.csv(features.area.economic, "../csv/features.area.economic.csv", row.names = FALSE)
write.csv(features.connection.assigned, "../csv/features.connection.assigned.csv", row.names = FALSE)
write.csv(features.connection.economic, "../csv/features.connection.economic.csv", row.names = FALSE)
save.image()
savehistory()
school2building.assigned[school2building.assigned$SCHOOL_ID == 10212,]
nrow(school2building.assigned[school2building.assigned$SCHOOL_ID == 10212,])
school2building.assigned.new <- school2building.assigned[school2building.assigned$SCHOOL_ID != 10212,]
school2building.assigned.to.change <- school2building.assigned[school2building.assigned$SCHOOL_ID == 10212,]
school2building.assigned.new[school2building.assigned.new$SCHOOL_ID == 10002,]
school2building.assigned.to.change <- data.frame(OLD_BUILDING_ID = school2building.assigned.new[school2building.assigned.new$SCHOOL_ID == 10002,]$OLD_BUILDING_ID, BUILDING_ID = school2building.assigned.new[school2building.assigned.new$SCHOOL_ID == 10002,]$BUILDING_ID)
school2building.assigned.to.change$SCHOOL_ID <- 10212
school2building.assigned.to.change <- school2building.assigned.to.change[c(3,1,2)]
View(school2building.assigned.to.change)
school2building.assigned.new <- rbind(school2building.assigned.new, school2building.assigned.to.change)
school2building.assigned.to.change <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID == 11406,]
school2building.assigned.new <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID != 11406,]
school2building.assigned.to.change[school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$ID %in% list(51,56),]$ID,]
school2building.assigned.to.change[school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$DISTRICT_ID %in% list(51,56),]$ID,]
nrow(school2building.assigned.to.change[school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$DISTRICT_ID %in% list(51,56),]$ID,])
school2building.assigned.to.change[!(school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$DISTRICT_ID %in% list(51,56),]$ID),]
nrow(school2building.assigned.to.change[!(school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$DISTRICT_ID %in% list(51,56),]$ID),])
school2building.assigned.to.change[!(school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$DISTRICT_ID %in% list(51,56),]$ID),]
school2building.assigned.to.change <- school2building.assigned.to.change[!(school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$DISTRICT_ID %in% list(51,56),]$ID),]
school2building.assigned.new <- rbind(school2building.assigned.new, school2building.assigned.to.change)
save.image()
school2building.assigned.to.change <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID == 10122,]
school2building.assigned.new <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID != 10122,]
View(school2building.assigned.to.change)
school2building.assigned.to.change[school2building.assigned.to.change$BUILDING_ID == 32895,]
school2building.assigned.to.change <- school2building.assigned.to.change[school2building.assigned.to.change$BUILDING_ID == 32895,]
school2building.assigned.new <- rbind(school2building.assigned.new, school2building.assigned.to.change)
school2building.assigned.to.change <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID == 10123,]
school2building.assigned.new <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID != 10123,]
save.image()
school2building.assigned.to.change <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID == 10907,]
school2building.assigned.new <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID != 10907,]
school2building.assigned.to.change <- school2building.assigned.to.change[!(school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$DISTRICT_ID %in% list(51,56),]$ID),]
school2building.assigned.new <- rbind(school2building.assigned.new, school2building.assigned.to.change)
save.image()
school2building.assigned.to.change <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID == 10752,]
school2building.assigned.new <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID != 10752,]
school2building.assigned.to.change <- school2building.assigned.to.change[school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$DISTRICT_ID == 112,]$ID),]
school2building.assigned.to.change <- school2building.assigned.to.change[school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$DISTRICT_ID == 112,]$ID,]
school2building.assigned.new <- rbind(school2building.assigned.new, school2building.assigned.to.change)
school2building.assigned.to.change <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID %in% list(11152,11286,11460),]
school2building.assigned.new <- school2building.assigned.new[!(school2building.assigned.new$SCHOOL_ID %in% list(11152,11286,11460)),]
school2building.assigned.to.change <- school2building.assigned.to.change[school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$DISTRICT_ID == 112,]$ID,]
school2building.assigned.new <- rbind(school2building.assigned.new, school2building.assigned.to.change)
save.image()
features.connection.assigned <- generate.connection.features(buildings, schools, school.blocks, school2building.assigned.new)
library("geosphere", lib.loc="~/R/i686-pc-linux-gnu-library/3.0")
features.connection.assigned <- generate.connection.features(buildings, schools, school.blocks, school2building.assigned.new)
school2building.assigned.to.change <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID %in% list(10358),]
school2building.assigned.new <- school2building.assigned.new[!(school2building.assigned.new$SCHOOL_ID %in% list(10358)),]
school2building.assigned.to.change <- school2building.assigned.to.change[school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$DISTRICT_ID %in% list(117,129),]$ID,]
school2building.assigned.new <- rbind(school2building.assigned.new, school2building.assigned.to.change)
save.image()
school2building.assigned.to.change <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID %in% list(10264,10708),]
school2building.assigned.new <- school2building.assigned.new[!(school2building.assigned.new$SCHOOL_ID %in% list(10264,10708)),]
school2building.assigned.to.change <- school2building.assigned.to.change[school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$DISTRICT_ID %in% list(96),]$ID,]
school2building.assigned.new <- rbind(school2building.assigned.new, school2building.assigned.to.change)
save.image()
school2building.assigned.to.change <- school2building.assigned.new[school2building.assigned.new$SCHOOL_ID %in% list(10094,10255),]
school2building.assigned.new <- school2building.assigned.new[!(school2building.assigned.new$SCHOOL_ID %in% list(10094,10255)),]
school2building.assigned.to.change <- school2building.assigned.to.change[school2building.assigned.to.change$BUILDING_ID %in% buildings[buildings$DISTRICT_ID %in% list(122),]$ID,]
school2building.assigned.new <- rbind(school2building.assigned.new, school2building.assigned.to.change)
save.image()
area.features.assigned <- generate.area.features(buildings, schools, school.blocks, school2building.assigned.new)
write.csv(features.area.assigned, "../csv/features.area.assigned.csv", row.names = FALSE)
write.csv(school2building.assigned.new, "../csv/school2building-assigned.csv", row.names = FALSE)
save.image()
savehistory()
