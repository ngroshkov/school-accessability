solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
school2building.assigned.new <- fix.school2building.right.district(school2building.assigned.new, wrongSchoolId[1], list(99)); solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
school2building.assigned.new <- fix.school2building.right.district(school2building.assigned.new, wrongSchoolId[1], list(59)); solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
school2building.assigned.new <- fix.school2building.right.district(school2building.assigned.new, wrongSchoolId[1], list(144)); solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
school2building.assigned.new <- fix.school2building.right.district(school2building.assigned.new, wrongSchoolId[1], list(106,97)); solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
school2building.assigned.new <- fix.school2building.right.district(school2building.assigned.new, wrongSchoolId[1], list(106,97,84,81)); solvedSchoolIds <- c(solvedSchoolIds,wrongSchoolId[1]); wrongSchoolId <- wrongSchoolId[wrongSchoolId != wrongSchoolId[1]]; wrongSchoolId
save.image()
savehistory()
features.area.assigned <- generate.area.features(buildings, schools, school.blocks, school2building.assigned.new)
library("geosphere", lib.loc="~/R/i686-pc-linux-gnu-library/3.0")
library("geosphere", lib.loc="~/R/i686-pc-linux-gnu-library/3.0")
features.area.assigned <- generate.area.features(buildings, schools, school.blocks, school2building.assigned.new)
write.csv(features.area.assigned, "../csv/features.area.assigned.csv", row.names = FALSE)
save.image()
savehistory()
View(features.area.assigned)
write.csv(features.area.assigned, "../csv/features.area.assigned.csv", row.names = FALSE)
schools <- read.csv("../csv/schools.csv")
View(schools)
save.image()
schools <- read.csv("../csv/schools.csv")
save.image()
savehistory()
write.csv(school.blocks, "../csv/school.blocks.csv", row.names = FALSE, na = "")
write.csv(schools, "../csv/schools.csv", row.names = FALSE, na = "")
write.csv(complexes, "../csv/complexes.csv", row.names = FALSE, na = "")
max(schools$ID)
max(complexes$ID)
read.csv(school.blocks, "../csv/school.blocks.csv", stringsAsFactors = FALSE)
read.csv(school.blocks, "../csv/school.blocks.csv", stringsAsFactors = FALSE)
read.csv(school.blocks, "../csv/school.blocks.csv", stringsAsFactors = FALSE)
read.csv(school.blocks, "../csv/school.blocks.csv", stringsAsFactors = FALSE)
read.csv(school.blocks, "../csv/school.blocks.csv", stringsAsFactors = FALSE)
read.csv(schools, "../csv/schools.csv", stringsAsFactors = FALSE)
schools <- read.csv("../csv/schools.csv", stringsAsFactors = FALSE)
school.blocks <- read.csv("../csv/school.blocks.csv", stringsAsFactors = FALSE)
complexes <- read.csv("../csv/complexes.csv", stringsAsFactors = FALSE)
save.image()
savehistory()
View(schools)
schools[schools$NUMB=824,]
schools[schools$NUMB==824,]
max(complexes$ID)
max(complexes$ID)+1
87+152+267
max(schools$ID)+1
max(school.blocks$ID)+1
complexes <- read.csv("../csv/complexes.csv", stringsAsFactors = FALSE)
school.blocks <- read.csv("../csv/school.blocks.csv", stringsAsFactors = FALSE)
schools <- read.csv("../csv/schools.csv", stringsAsFactors = FALSE)
View(schools)
save.image()
savehistory()
max(complexes$ID)+1
101+123+48
max(school.blocks$ID)+1
max(schools$ID)+1
complexes <- read.csv("../csv/complexes.csv", stringsAsFactors = FALSE)
school.blocks <- read.csv("../csv/school.blocks.csv", stringsAsFactors = FALSE)
schools <- read.csv("../csv/schools.csv", stringsAsFactors = FALSE)
save.image()
savehistory()
View(schools)
schools <- read.csv("../csv/schools.csv", stringsAsFactors = FALSE)
save.image()
rm(wrongSchoolId)
rm(solvedSchoolIds)
buildings.old2 <- buildings.old
buildings.old <- buildings
View(s2b.longest)
View(s2b.longest)
View(s2b.solved)
rm(s2b.solved, s2b.longest)
school2building.catchement.old <- school2building.assigned
rm(school2building.assigned)
rm(school2building.assigned.to.change)
rm(school2building.assigned.new)
View(school2building.dist)
rm(school2building.dist)
school2building.economic.old <- school2building.economic
rm(school2building.economic)
buildings <- read.csv("/media/WORK/Dropbox/ВШУ/new.school2buiding/final/buildings.csv", stringsAsFactors = FALSE)
View(buildings.old)
school2building.catchement <- read.csv("/media/WORK/Dropbox/ВШУ/new.school2buiding/final/school2building.csv", stringsAsFactors = FALSE)
save.image()
savehistory()
View(buildings)
buildings$DISTRICT1 <- as.factor(buildings$DISTRICT)
View(buildings)
buildings$DISTRICT1 <- as.factor(buildings$DISTRICT)
buildings$DISTRICT <- as.factor(buildings$DISTRICT)
buildings$DISTRICT1 <- NULL
View(buildings)
buildings$OKRUG <- as.factor(buildings$OKRUG)
save.image()
savehistory()
write.csv("../csv/buildings1.csv", row.names = FALSE, na = "")
write.csv(buildings, "../csv/buildings1.csv", row.names = FALSE, na = "")
buildings$OBJECTID_12 <- NULL
View(buildings)
write.csv(buildings, "../csv/buildings1.csv", row.names = FALSE, na = "")
write.csv(school2building.catchement, "../csv/school2building-catchement.csv", row.names = FALSE, na = "")
save.image()
savehistory()
b <- read.csv("/media/WORK/Dropbox/ВШУ/new.school2buiding/final/d.csv", stringsAsFactors = FALSE)
buildings1 <- merge(buildings, b, by = "ID")
View(buildings1)
buildings <- merge(buildings, b, by = "ID")
rm(buildings1)
rm(b)
View(buildings)
save.image()
savehistory()
View(features.area.assigned)
features.area.catchement <- generate.area.features(buildings, schools, school.blocks, school2building.catchement)
View(school2building.catchement)
View(school2building.catchement.old)
features.area.catchement <- generate.area.features(buildings, schools, school.blocks, school2building.catchement)
s2b <- school2building[school2building$SCHOOL_ID == 10001,]
s2b <- school2building.catchement[school2building.catchement$SCHOOL_ID == 10001,]
rm(s2b)
debugSource('/media/WORK/hse/school-accessibility/r/generate-features.R')
features.area.catchement <- generate.area.features(buildings, schools, school.blocks, school2building.catchement)
debugSource('/media/WORK/hse/school-accessibility/r/generate-features.R')
debugSource('/media/WORK/hse/school-accessibility/r/generate-features.R')
features.area.catchement <- generate.area.features(buildings, schools, school.blocks, school2building.catchement)
View(s2b)
View(s2b)
buildings[buildings$ID %in% s2b$BUILDING_ID,][c(2, 10, 11)]
View(buildings)
grep("ID", colnames(buildings))
which(names(buildings)=="ID")
which(names(buildings)=="POINT_X")
debugSource('/media/WORK/hse/school-accessibility/r/generate-features.R')
generate.connection.features <- function(buildings, schools, school.blocks, school2building) {
generate.connection.features <- data.frame();
featureId <- 0;
buildingsColumnIds <- c(which(names(buildings)=="ID"), which(names(buildings)=="POINT_X"), which(names(buildings)=="POINT_Y"));
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
s2b <- school2building[school2building$SCHOOL_ID == sId,];
if (nrow(s2b) == 0) {
next;
}
s2b <- merge(s2b, buildings[buildings$ID %in% s2b$BUILDING_ID,][buildingsColumnIds], by.x = "BUILDING_ID", by.y = "ID");
s2b$BUILDING_POINT_X <- s2b$POINT_X;
s2b$BUILDING_POINT_Y <- s2b$POINT_Y;
s2b$POINT_X <- NULL;
s2b$POINT_Y <- NULL;
sbs <- school.blocks[school.blocks$SCHOOL_ID == sId,];
school.blocks.ids <- integer();
school.blocks.p_x <- numeric();
school.blocks.p_y <- numeric();
bearings <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
bp <- c(s2b$BUILDING_POINT_X[s2bIdx],s2b$BUILDING_POINT_Y[s2bIdx]);
dists <- integer();
for (sbIdx in 1:nrow(sbs)) {
dist <- distVincentyEllipsoid(bp, c(sbs$POINT_X[sbIdx], sbs$POINT_Y[sbIdx]));
dists <- c(dists, dist);
}
sbs$DIST <- dists;
closestSchoolBlock <- sbs[which(sbs$DIST == min(sbs$DIST)),];
school.blocks.ids <- c(school.blocks.ids, closestSchoolBlock$ID[1]);
school.blocks.p_x <- c(school.blocks.p_x, closestSchoolBlock$POINT_X[1]);
school.blocks.p_y <- c(school.blocks.p_y, closestSchoolBlock$POINT_Y[1]);
bearings <- c(bearings, bearing(c(closestSchoolBlock$POINT_X[1], closestSchoolBlock$POINT_Y[1]), bp));
};
s2b$SCHOOL_BLOCK_ID <- school.blocks.ids;
s2b$SCHOOL_BLOCK_POINT_X <- school.blocks.p_x;
s2b$SCHOOL_BLOCK_POINT_Y <- school.blocks.p_y;
s2b$BEARING <- bearings;
s2b <- s2b[order(s2b$SCHOOL_BLOCK_ID, s2b$BEARING),]
schs <- integer();
s.blks <- integer()
featureIds <- integer();
pointXs <- numeric();
pointYs <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
featureId <- featureId + 1;
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx]);
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$SCHOOL_BLOCK_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$SCHOOL_BLOCK_POINT_Y[s2bIdx]);
}
connection.features <-
data.frame(SCHOOL_ID = schs, SCHOOL_BLOCK_ID = s.blks, FEATURE_ID = featureIds, POINT_X = pointXs, POINT_Y = pointYs);
generate.connection.features <- rbind(generate.connection.features, connection.features);
print(paste(sIdx, " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
}
generate.connection.features;
}
generate.area.features <- function(buildings, schools, school.blocks, school2building) {
generate.area.features <- data.frame();
featureId <- 0;
buildingsColumnIds <- c(which(names(buildings)=="ID"), which(names(buildings)=="POINT_X"), which(names(buildings)=="POINT_Y"));
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
s2b <- school2building[school2building$SCHOOL_ID == sId,];
if (nrow(s2b) == 0) {
next;
}
s2b <- merge(s2b, buildings[buildings$ID %in% s2b$BUILDING_ID,][buildingsColumnIds], by.x = "BUILDING_ID", by.y = "ID");
s2b$BUILDING_POINT_X <- s2b$POINT_X;
s2b$BUILDING_POINT_Y <- s2b$POINT_Y;
s2b$POINT_X <- NULL;
s2b$POINT_Y <- NULL;
sbs <- school.blocks[school.blocks$SCHOOL_ID == sId,];
school.blocks.ids <- integer();
school.blocks.p_x <- numeric();
school.blocks.p_y <- numeric();
bearings <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
bp <- c(s2b$BUILDING_POINT_X[s2bIdx],s2b$BUILDING_POINT_Y[s2bIdx]);
dists <- integer();
for (sbIdx in 1:nrow(sbs)) {
dist <- distVincentyEllipsoid(bp, c(sbs$POINT_X[sbIdx], sbs$POINT_Y[sbIdx]));
dists <- c(dists, dist);
}
sbs$DIST <- dists;
closestSchoolBlock <- sbs[which(sbs$DIST == min(sbs$DIST)),];
school.blocks.ids <- c(school.blocks.ids, closestSchoolBlock$ID[1]);
school.blocks.p_x <- c(school.blocks.p_x, closestSchoolBlock$POINT_X[1]);
school.blocks.p_y <- c(school.blocks.p_y, closestSchoolBlock$POINT_Y[1]);
bearings <- c(bearings, bearing(c(closestSchoolBlock$POINT_X[1], closestSchoolBlock$POINT_Y[1]), bp));
};
s2b$SCHOOL_BLOCK_ID <- school.blocks.ids;
s2b$SCHOOL_BLOCK_POINT_X <- school.blocks.p_x;
s2b$SCHOOL_BLOCK_POINT_Y <- school.blocks.p_y;
s2b$BEARING <- bearings;
s2b <- s2b[order(s2b$SCHOOL_BLOCK_ID, s2b$BEARING),]
schs <- integer();
s.blks <- integer()
featureIds <- integer();
pointXs <- numeric();
pointYs <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
featureId <- featureId + 1;
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx]);
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
if (s2bIdx + 1 > nrow(s2b) | s2b$SCHOOL_BLOCK_ID[s2bIdx] != s2b$SCHOOL_BLOCK_ID[s2bIdx+1]) {
s2b.first <- s2b[s2b$SCHOOL_BLOCK_ID == s2b$SCHOOL_BLOCK_ID[s2bIdx],];
pointXs <- c(pointXs, s2b.first$BUILDING_POINT_X[1]);
pointYs <- c(pointYs, s2b.first$BUILDING_POINT_Y[1]);
} else {
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx+1]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx+1]);
}
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$SCHOOL_BLOCK_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$SCHOOL_BLOCK_POINT_Y[s2bIdx]);
}
area.features <-
data.frame(SCHOOL_ID = schs, SCHOOL_BLOCK_ID = s.blks, FEATURE_ID = featureIds, POINT_X = pointXs, POINT_Y = pointYs);
generate.area.features <- rbind(generate.area.features, area.features);
print(paste(sIdx, " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
}
generate.area.features;
}
generate.connection.features <- function(buildings, schools, school.blocks, school2building) {
generate.connection.features <- data.frame();
featureId <- 0;
buildingsColumnIds <- c(which(names(buildings)=="ID"), which(names(buildings)=="POINT_X"), which(names(buildings)=="POINT_Y"));
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
s2b <- school2building[school2building$SCHOOL_ID == sId,];
if (nrow(s2b) == 0) {
next;
}
s2b <- merge(s2b, buildings[buildings$ID %in% s2b$BUILDING_ID,][buildingsColumnIds], by.x = "BUILDING_ID", by.y = "ID");
s2b$BUILDING_POINT_X <- s2b$POINT_X;
s2b$BUILDING_POINT_Y <- s2b$POINT_Y;
s2b$POINT_X <- NULL;
s2b$POINT_Y <- NULL;
sbs <- school.blocks[school.blocks$SCHOOL_ID == sId,];
school.blocks.ids <- integer();
school.blocks.p_x <- numeric();
school.blocks.p_y <- numeric();
bearings <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
bp <- c(s2b$BUILDING_POINT_X[s2bIdx],s2b$BUILDING_POINT_Y[s2bIdx]);
dists <- integer();
for (sbIdx in 1:nrow(sbs)) {
dist <- distVincentyEllipsoid(bp, c(sbs$POINT_X[sbIdx], sbs$POINT_Y[sbIdx]));
dists <- c(dists, dist);
}
sbs$DIST <- dists;
closestSchoolBlock <- sbs[which(sbs$DIST == min(sbs$DIST)),];
school.blocks.ids <- c(school.blocks.ids, closestSchoolBlock$ID[1]);
school.blocks.p_x <- c(school.blocks.p_x, closestSchoolBlock$POINT_X[1]);
school.blocks.p_y <- c(school.blocks.p_y, closestSchoolBlock$POINT_Y[1]);
bearings <- c(bearings, bearing(c(closestSchoolBlock$POINT_X[1], closestSchoolBlock$POINT_Y[1]), bp));
};
s2b$SCHOOL_BLOCK_ID <- school.blocks.ids;
s2b$SCHOOL_BLOCK_POINT_X <- school.blocks.p_x;
s2b$SCHOOL_BLOCK_POINT_Y <- school.blocks.p_y;
s2b$BEARING <- bearings;
s2b <- s2b[order(s2b$SCHOOL_BLOCK_ID, s2b$BEARING),]
schs <- integer();
s.blks <- integer()
featureIds <- integer();
pointXs <- numeric();
pointYs <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
featureId <- featureId + 1;
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx]);
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$SCHOOL_BLOCK_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$SCHOOL_BLOCK_POINT_Y[s2bIdx]);
}
connection.features <-
data.frame(SCHOOL_ID = schs, SCHOOL_BLOCK_ID = s.blks, FEATURE_ID = featureIds, POINT_X = pointXs, POINT_Y = pointYs);
generate.connection.features <- rbind(generate.connection.features, connection.features);
print(paste(sIdx, " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
}
generate.connection.features;
}
generate.area.features <- function(buildings, schools, school.blocks, school2building) {
generate.area.features <- data.frame();
featureId <- 0;
buildingsColumnIds <- c(which(names(buildings)=="ID"), which(names(buildings)=="POINT_X"), which(names(buildings)=="POINT_Y"));
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
s2b <- school2building[school2building$SCHOOL_ID == sId,];
if (nrow(s2b) == 0) {
next;
}
s2b <- merge(s2b, buildings[buildings$ID %in% s2b$BUILDING_ID,][buildingsColumnIds], by.x = "BUILDING_ID", by.y = "ID");
s2b$BUILDING_POINT_X <- s2b$POINT_X;
s2b$BUILDING_POINT_Y <- s2b$POINT_Y;
s2b$POINT_X <- NULL;
s2b$POINT_Y <- NULL;
sbs <- school.blocks[school.blocks$SCHOOL_ID == sId,];
school.blocks.ids <- integer();
school.blocks.p_x <- numeric();
school.blocks.p_y <- numeric();
bearings <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
bp <- c(s2b$BUILDING_POINT_X[s2bIdx],s2b$BUILDING_POINT_Y[s2bIdx]);
dists <- integer();
for (sbIdx in 1:nrow(sbs)) {
dist <- distVincentyEllipsoid(bp, c(sbs$POINT_X[sbIdx], sbs$POINT_Y[sbIdx]));
dists <- c(dists, dist);
}
sbs$DIST <- dists;
closestSchoolBlock <- sbs[which(sbs$DIST == min(sbs$DIST)),];
school.blocks.ids <- c(school.blocks.ids, closestSchoolBlock$ID[1]);
school.blocks.p_x <- c(school.blocks.p_x, closestSchoolBlock$POINT_X[1]);
school.blocks.p_y <- c(school.blocks.p_y, closestSchoolBlock$POINT_Y[1]);
bearings <- c(bearings, bearing(c(closestSchoolBlock$POINT_X[1], closestSchoolBlock$POINT_Y[1]), bp));
};
s2b$SCHOOL_BLOCK_ID <- school.blocks.ids;
s2b$SCHOOL_BLOCK_POINT_X <- school.blocks.p_x;
s2b$SCHOOL_BLOCK_POINT_Y <- school.blocks.p_y;
s2b$BEARING <- bearings;
s2b <- s2b[order(s2b$SCHOOL_BLOCK_ID, s2b$BEARING),]
schs <- integer();
s.blks <- integer()
featureIds <- integer();
pointXs <- numeric();
pointYs <- numeric();
for(s2bIdx in 1:nrow(s2b)) {
featureId <- featureId + 1;
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx]);
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
if (s2bIdx + 1 > nrow(s2b) | s2b$SCHOOL_BLOCK_ID[s2bIdx] != s2b$SCHOOL_BLOCK_ID[s2bIdx+1]) {
s2b.first <- s2b[s2b$SCHOOL_BLOCK_ID == s2b$SCHOOL_BLOCK_ID[s2bIdx],];
pointXs <- c(pointXs, s2b.first$BUILDING_POINT_X[1]);
pointYs <- c(pointYs, s2b.first$BUILDING_POINT_Y[1]);
} else {
pointXs <- c(pointXs, s2b$BUILDING_POINT_X[s2bIdx+1]);
pointYs <- c(pointYs, s2b$BUILDING_POINT_Y[s2bIdx+1]);
}
schs <- c(schs, s2b$SCHOOL_ID[s2bIdx]);
s.blks <- c(s.blks, s2b$SCHOOL_BLOCK_ID[s2bIdx]);
featureIds <- c(featureIds, featureId);
pointXs <- c(pointXs, s2b$SCHOOL_BLOCK_POINT_X[s2bIdx]);
pointYs <- c(pointYs, s2b$SCHOOL_BLOCK_POINT_Y[s2bIdx]);
}
area.features <-
data.frame(SCHOOL_ID = schs, SCHOOL_BLOCK_ID = s.blks, FEATURE_ID = featureIds, POINT_X = pointXs, POINT_Y = pointYs);
generate.area.features <- rbind(generate.area.features, area.features);
print(paste(sIdx, " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
}
generate.area.features;
}
save.image()
savehistory()
features.area.catchement <- generate.area.features(buildings, schools, school.blocks, school2building.catchement)
library("geosphere", lib.loc="~/R/i686-pc-linux-gnu-library/3.0")
features.area.catchement <- generate.area.features(buildings, schools, school.blocks, school2building.catchement)
View(features.area.assigned)
View(features.area.assigned)
View(features.area.economic)
View(features.area.catchement)
rm(features.area.assigned)
features.connection.catchement  <- generate.connection.features(buildings, schools, school.blocks, school2building.catchement)
rm(features.connection.assigned)
save.image()
savehistory()
write.csv(features.area.catchement, "../csv/features.area.catchement.csv", row.names = FALSE)
write.csv(features.connection.catchement, "../csv/features.connection.catchement.csv", row.names = FALSE)
school.blocks[school.blocks$ID == 906,]
schools[schools$ID == school.blocks[school.blocks$ID == 906,]$ID,]
schools[schools$ID == school.blocks[school.blocks$ID == 906,]$SCHOOL_ID,]
complex[complex$ID == schools[schools$ID == school.blocks[school.blocks$ID == 906,]$SCHOOL_ID,]$COMPLEX_ID,]
complexes[complexes$ID == schools[schools$ID == school.blocks[school.blocks$ID == 906,]$SCHOOL_ID,]$COMPLEX_ID,]
schools[schools$COMPLEX_ID == 843,]
schools[schools$ID == 10199,]
schools[schools$COMPLEX_ID == 497,]
schools[schools$ID == 10198,]
schools[schools$ID == 10198,]$RAYON
schools[schools$ID == 10198,]$RAYON <- "Печатники"
schools[schools$ID == 10198,]$RAYON
schools[schools$COMPLEX_ID == 497,]
write.csv(x = schools, file = "../csv/schools.csv", row.names = FALSE, na = "")
write.csv(x = school.blocks, file = "../csv/school.blocks.csv", row.names = FALSE, na = "")
complexes$X <- NULL
write.csv(x = complexes, file = "../csv/complexes.csv", row.names = FALSE, na = "")
save.image()
max(school.blocks$ID)
school.blocks <- read.csv("../csv/school.blocks.csv", stringsAsFactors = FALSE)
View(school.blocks)
save.image()
savehistory()
schools[schools$ID == 10622,]
schools[schools$COMPLEX_ID == 35,]
schools[schools$COMPLEX_ID == 35,]
complexes[complexes$ID == 35,]
complexes[complexes$NUMB == 2107,]
complexes[complexes$NUMB == 2105,]
schools[schools$COMPLEX_ID == 31,]
complexes[complexes$NUMB == 2107,]
schools[schools$COMPLEX_ID == 35,]
save.image()
savehistory()
a1 <- read.csv("/media/WORK/Dropbox/ВШУ/new.school2buiding/fix/a1.csv", stringsAsFactors = FALSE)
a2 <- read.csv("/media/WORK/Dropbox/ВШУ/new.school2buiding/fix/a2.csv", stringsAsFactors = FALSE)
a3 <- read.csv("/media/WORK/Dropbox/ВШУ/new.school2buiding/fix/a3.csv", stringsAsFactors = FALSE)
a4 <- read.csv("/media/WORK/Dropbox/ВШУ/new.school2buiding/fix/a4.csv", stringsAsFactors = FALSE)
a51 <- read.csv("/media/WORK/Dropbox/ВШУ/new.school2buiding/fix/a51.csv", stringsAsFactors = FALSE)
a52 <- read.csv("/media/WORK/Dropbox/ВШУ/new.school2buiding/fix/a52.csv", stringsAsFactors = FALSE)
View(a52)
View(a51)
school2building.catchement.old2 <- school2building.catchement
View(a1)
View(school2building.catchement)
View(a2)
View(a3)
View(a4)
View(a51)
View(a52)
school2building.catchement <- school2building.catchement[!school2building.catchement$BUILDING_ID %in% a1$BUILDING_ID,]
length(unique(a1$BUILDING_ID))
school2building.catchement <- school2building.catchement[!school2building.catchement$BUILDING_ID %in% a2$BUILDING_ID,]
school2building.catchement <- school2building.catchement[!school2building.catchement$BUILDING_ID %in% a3$BUILDING_ID,]
school2building.catchement <- school2building.catchement[!school2building.catchement$BUILDING_ID %in% a4$BUILDING_ID,]
school2building.catchement <- school2building.catchement[!school2building.catchement$BUILDING_ID %in% a51$BUILDING_ID,]
school2building.catchement <- school2building.catchement[!school2building.catchement$BUILDING_ID %in% a52$BUILDING_ID,]
school2building.catchement <- rbind(school2building.catchement, a1)
school2building.catchement <- rbind(school2building.catchement, a2)
school2building.catchement <- rbind(school2building.catchement, a3)
school2building.catchement <- rbind(school2building.catchement, a4)
school2building.catchement <- rbind(school2building.catchement, a51)
school2building.catchement <- rbind(school2building.catchement, a52)
rm(a1,a2,a3,a4,a51,a52)
write.csv(school2building.catchement, "../csv/school2building-catchement.csv", row.names = FALSE, na = "")
library("geosphere", lib.loc="~/R/i686-pc-linux-gnu-library/3.0")
features.connection.catchement  <- generate.connection.features(buildings, schools, school.blocks, school2building.catchement)
features.area.catchement <- generate.area.features(buildings, schools, school.blocks, school2building.catchement)
write.csv(features.area.catchement, "../csv/features.area.catchement.csv", row.names = FALSE)
write.csv(features.connection.catchement, "../csv/features.connection.catchement.csv", row.names = FALSE)
save.image()
savehistory()
