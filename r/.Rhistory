}
complex.size = data.frame(step1v, step2v, step3v);
complex.size;
}
cs <- complex.size(complexes)
complex.size = function(complexes){
xPathStep1 <- "//h3[text()='Сведения о реализации образовательных программ']/following-sibling::table[1]/tbody/tr/td[text()='Начальное общее']/following-sibling::td[2]/text()";
xPathStep2 <- "//h3[text()='Сведения о реализации образовательных программ']/following-sibling::table[1]/tbody/tr/td[text()='Основное общее']/following-sibling::td[2]/text()";
xPathStep3 <- "//h3[text()='Сведения о реализации образовательных программ']/following-sibling::table[1]/tbody/tr/td[text()='Среднее общее']/following-sibling::td[2]/text()";
step1v <- numeric();
step2v <- numeric();
step3v <- numeric();
for (cIdx in 1:nrow(complexes)) {
url <- complexes$WEBSITE[cIdx];
step1 <- NA;
step2 <- NA;
step3 <- NA;
if (!is.null(url)) {
page <- htmlParse(paste(url, "info_edu/education/"));
nodes1 <- xpathApply(doc = page, path = xPathStep1);
nodes2 <- xpathApply(doc = page, path = xPathStep2);
nodes3 <- xpathApply(doc = page, path = xPathStep3);
if (length(nodes1) > 0) {
step1 <- as.numeric(xmlValue(nodes1[[1]]));
};
if (length(nodes2) > 0) {
step2 <- as.numeric(xmlValue(nodes2[[1]]));
};
if (length(nodes3) > 0) {
step3 <- as.numeric(xmlValue(nodes3[[1]]));
};
};
step1v <- c(step1v, step1);
step2v <- c(step2v, step2);
step3v <- c(step3v, step3);
print(paste(cIdx, " ", url, " ", round((100*cIdx)/nrow(complexes), digits = 2), "%", sep = ""));
}
complex.size = data.frame(step1v, step2v, step3v);
complex.size;
}
cs <- complex.size(complexes)
complexes <- read.csv(file = "./../temp/complexes.csv")
View(complexes)
cs
cs <- complex.size(complexes)
url <- "http://gym1409s-new.mskobr.ru/";
page <- htmlParse(paste(url, "info_edu/education/"));
step1 <- as.numeric(xmlValue(xpathApply(doc = page, path = "//h3[text()='Сведения о реализации образовательных программ']/following-sibling::table[1]/tbody/tr/td[text()='Начальное общее']/following-sibling::td[2]/text()")[[1]]));
xPathStep1 <- "//h3[text()='Сведения о реализации образовательных программ']/following-sibling::table[1]/tbody/tr/td[text()='Начальное общее']/following-sibling::td[2]/text()";
xPathStep2 <- "//h3[text()='Сведения о реализации образовательных программ']/following-sibling::table[1]/tbody/tr/td[text()='Основное общее']/following-sibling::td[2]/text()";
xPathStep3 <- "//h3[text()='Сведения о реализации образовательных программ']/following-sibling::table[1]/tbody/tr/td[text()='Среднее общее']/following-sibling::td[2]/text()";
nodes1 <- xpathApply(doc = page, path = xPathStep1);
nodes2 <- xpathApply(doc = page, path = xPathStep2);
nodes3 <- xpathApply(doc = page, path = xPathStep3);
nodes1
nodes2
nodes3
rm (nodes1)
rm (nodes2)
rm (nodes3)
rm (xPathStep1)
rm (xPathStep2)
rm (xPathStep3)
rm (step1)
cs <- complex.size(tail(head(complexes, n = 46), n = 1))
cs
cs <- complex.size(tail(head(complexes, n = 47), n = 1))
;
cs <- complex.size(tail(head(complexes, n = 47), n = 1))
cs <- complex.size(complexes)
rm(cs)
cs20 <- complex.size(tail(head(complexes, n = 20), n = 20))
cs20
cs <- cs20
cs$step1v[10] <- 644
cs
cs$step2v[10] <- 720
cs$step3v[10] <- 155
cs
cs40 <- complex.size(tail(head(complexes, n = 40), n = 20))
cs40
ncs <- rbind(cs, cs40)
ncs
cs <- ncs
rm (ncs)
rm (cs20)
cs40
cs
cs$step1v[30] <- 819
cs$step2v[30] <- 831
cs$step3v[30] <- 142
cs
cs$step1v[34] <- 468
cs$step2v[34] <- 529
cs$step2v[34] <- 130
cs$step2v[34] <- 529
cs$step3v[34] <- 130
cs
complexes <- read.csv(file = "./../temp/complexes.csv")
View(complexes)
cs
rm(cs40)
cs60 <- complex.size(tail(head(complexes, n = 60), n = 20))
cs60
cs <- rbind(cs, cs60)
rm(cs60)
cs80 <- complex.size(tail(head(complexes, n = 80), n = 20))
cs80
cs <- rbind(cs, cs80)
cs100 <- complex.size(tail(head(complexes, n = 100), n = 20))
cs100
complexes <- read.csv(file = "./../temp/complexes.csv")
cs100$step1v[12] <- 1451
cs100$step2v[12] <- 1590
cs100$step3v[12] <- 425
cs100
cs <- rbind(cs, cs100)
rm(cs80)
rm(cs100)
cs120 <- complex.size(tail(head(complexes, n = 120), n = 20))
cs120
cs120$step1v[12] <- 568
cs120$step2v[12] <- 924
cs120$step3v[12] <- 669
cs <- rbind(cs, cs120)
rm(cs120)
cs140 <- complex.size(tail(head(complexes, n = 140), n = 20))
cs140
cs140$step3v[20] <- 980
cs140$step1v[20] <- 980
cs140$step2v[20] <- 980
cs140$step2v[20] <- 1092
cs140$step3v[20] <- 365
cs140
cs <- rbind(cs, cs140)
rm(140)
rm(cs140)
cs160 <- complex.size(tail(head(complexes, n = 160), n = 20))
cs160
cs <- rbind(cs, cs160)
rm(cs160)
complexes <- read.csv(file = "./../temp/complexes.csv")
cs180 <- complex.size(tail(head(complexes, n = 180), n = 20))
cs180 <- complex.size(tail(head(complexes, n = 180), n = 20))
cs180
cs <- rbind(cs, cs180)
rm(cs180)
complexes <- read.csv(file = "./../temp/complexes.csv")
cs200 <- complex.size(tail(head(complexes, n = 200), n = 20))
cs200
cs <- rbind(cs, cs200)
rm(cs200)
complexes <- read.csv(file = "./../temp/complexes.csv")
cs220 <- complex.size(tail(head(complexes, n = 220), n = 20))
cs220
cs220$step1v[14] <- 1346
cs220$step2v[14] <- 1391
cs220$step3v[14] <- 296
cs220
cs <- rbind(cs, cs220)
rm(cs220)
complexes <- read.csv(file = "./../temp/complexes.csv")
cs240 <- complex.size(tail(head(complexes, n = 240), n = 20))
cs240 <- complex.size(tail(head(complexes, n = 240), n = 20))
cs240
cs <- rbind(cs, cs240)
rm(cs240)
cs260 <- complex.size(tail(head(complexes, n = 260), n = 20))
cs260
cs <- rbind(cs, cs260)
rm(cs260)
cs280 <- complex.size(tail(head(complexes, n = 280), n = 20))
cs280
cs <- rbind(cs, cs280)
rm(cs280)
cs300 <- complex.size(tail(head(complexes, n = 300), n = 20))
cs300
cs <- rbind(cs, cs300)
cs320 <- complex.size(tail(head(complexes, n = 320), n = 20))
cs320 <- complex.size(tail(head(complexes, n = 320), n = 20))
cs320
cs320$step1v[6] <- 1371
cs320$step2v[6] <- 1385
cs320$step3v[6] <- 325
cs320
cs <- rbind(cs, cs320)
rm(cs300)
rm(cs320)
cs340 <- complex.size(tail(head(complexes, n = 340), n = 20))
cs340 <- complex.size(tail(head(complexes, n = 340), n = 20))
cs340
cs <- rbind(cs, cs340)
rm(cs340)
cs360 <- complex.size(tail(head(complexes, n = 360), n = 20))
cs360
cs360$step1v[6] <- 1371
cs360$step1v[6] <- 1385
cs360$step1v[6] <- 1371
cs360$step2v[6] <- 1385
cs360$step3v[6] <- 325
cs360
cs <- rbind(cs, cs360)
rm(cs360)
cs380 <- complex.size(tail(head(complexes, n = 380), n = 20))
cs360
cs380
cs380$step1v[9] <- 1656
cs380$step2v[9] <- 1800
cs380$step3v[9] <- 453
cs <- rbind(cs, cs380)
cs$step1v[375] <- 1656
cs$step2v[375] <- 1800
cs$step3v[375] <- 453
cs
rm(cs380)
complexes <- read.csv(file = "./../temp/complexes.csv")
cs400 <- complex.size(tail(head(complexes, n = 400), n = 20))
cs400
cs400$step1v[2] <- 1656
cs400$step2v[2] <- 1800
cs400$step3v[2] <- 453
cs <- rbind(cs, cs400)
rm(cs400)
cs420 <- complex.size(tail(head(complexes, n = 420), n = 20))
cs420
cs <- rbind(cs, cs420)
rm(cs420)
cs440 <- complex.size(tail(head(complexes, n = 440), n = 20))
cs440
cs <- rbind(cs, cs440)
rm(cs440)
cs460 <- complex.size(tail(head(complexes, n = 460), n = 20))
cs460
cs <- rbind(cs, cs460)
rm(cs460)
cs480 <- complex.size(tail(head(complexes, n = 480), n = 20))
cs480
cs <- rbind(cs, cs480)
rm(cs480)
cs500 <- complex.size(tail(head(complexes, n = 500), n = 20))
cs500
cs <- rbind(cs, cs500)
rm(cs500)
cs520 <- complex.size(tail(head(complexes, n = 520), n = 20))
cs520
cs <- rbind(cs, cs520)
rm(cs520)
cs540 <- complex.size(tail(head(complexes, n = 540), n = 20))
cs540
cs <- rbind(cs, cs540)
rm(cs540)
cs560 <- complex.size(tail(head(complexes, n = 560), n = 20))
cs560
cs <- rbind(cs, cs560)
rm(cs560)
cs580 <- complex.size(tail(head(complexes, n = 580), n = 20))
cs580 <- complex.size(tail(head(complexes, n = 580), n = 20))
cs580
cs <- rbind(cs, cs580)
rm(cs580)
cs600 <- complex.size(tail(head(complexes, n = 600), n = 20))
cs600
cs <- rbind(cs, cs600)
rm(cs600)
cs620 <- complex.size(tail(head(complexes, n = 620), n = 20))
cs620
cs <- rbind(cs, cs620)
rm(cs620)
cs640 <- complex.size(tail(head(complexes, n = 640), n = 20))
cs640 <- complex.size(tail(head(complexes, n = 640), n = 20))
complexes <- read.csv(file = "./../temp/complexes.csv")
cs640 <- complex.size(tail(head(complexes, n = 640), n = 20))
complexes <- read.csv(file = "./../temp/complexes.csv")
cs640 <- complex.size(tail(head(complexes, n = 640), n = 20))
complexes <- read.csv(file = "./../temp/complexes.csv")
complexes <- read.csv(file = "./../temp/complexes.csv")
cs640 <- complex.size(tail(head(complexes, n = 640), n = 20))
complexes <- read.csv(file = "./../temp/complexes.csv")
cs640 <- complex.size(tail(head(complexes, n = 640), n = 20))
complexes <- read.csv(file = "./../temp/complexes.csv")
cs640 <- complex.size(tail(head(complexes, n = 640), n = 20))
cs640
cs640$step1v[8] <- 619
cs640$step2v[8] <- 628
cs640$step3v[8] <- 102
cs640
cs640$step3v[18] <- 639
cs640$step1v[18] <- 639
cs640$step2v[18] <- 638
cs640$step3v[18] <- 178
cs640
cs <- rbind(cs, cs640)
rm(cs640)
cs646 <- complex.size(tail(head(complexes, n = 646), n = 6))
cs646
cs <- rbind(cs, cs646)
rm(cs646)
save.image()
savehistory()
write.csv(cs, file="cs.csv")
merge(complexes, cs)
View(cs)
data.frame(complexes, cs)
new_complexes <- data.frame(complexes, cs)
View(new_complexes)
complexes <- new_complexes
attributes(complexes)
complexes$names
names(complexes)
names(complexes)[10]
names(complexes)[10] <- "STEP1"
names(complexes)[10]
complexes$names
complexes$names
attributes(complexes)
names(complexes)[11] <- "STEP2"
names(complexes)[12] <- "STEP3"
attributes(complexes)
View(complexes)
rm(new_complexes)
save.image()
savehistory()
write.csv(cs, file="cs.csv")
write.csv(complexes, file="cs.csv")
savehistory()
save.image()
View(complexes)
View(r)
rm(r)
View(complexes)
rm(cs)
rm(url)
rm(page)
View(schools)
schools_old <- schools
schools <- read.csv("../temp/schools_point.csv")
schools <- read.csv2("../temp/schools_point.csv")
schools <- read.csv("../temp/schools_point.csv")
View(schools)
schools <- read.csv("../csv/schools_point.csv")
schools <- read.csv(sep = ',', "../csv/schools_point.csv")
schools <- read.csv(sep = ',', "../csv/schools_point.csv")
schools <- read.csv("../csv/schools_point.csv")
schools <- read.csv("../csv/schools_point.csv")
schools <- read.csv(sep = ';', "../csv/schools_point.csv")
save.image()
savehistory()
school2building <- read.csv(sep = ';', "../csv/school2building.csv")
View(school2building)
school2building <- read.csv(sep = ',', "../csv/school2building.csv")
savehistory()
save.image()
newId <- c(10000:11497)
newId
schools$NEW_ID <- newId
newId <- c(10001:11497)
schools$NEW_ID <- newId
View(schools)
schools[c(1,2,11,3,4,5,6,7,8,9,10)]
schools_new <- schools[c(1,2,11,3,4,5,6,7,8,9,10)]
View(schools_new)
schools <- schools_new
View(schools)
rm(schools_new)
rm(newId)
school2building$SCHOOL_NEW_ID <- school2building$SCHOOL_ID
View(school2building)
new.building2school = function(schools, school2building){
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
sNewId <- schools$NEW_ID[sIdx];
for (s2bIdx in 1:nrow(school2building)) {
school2building$SCHOOL_NEW_ID[school2building$SCHOOL_NEW_ID == sId] <- sNewId;
}
print(paste(sIdx, " ", schools$NAME[sIdx], " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
};
new.building2school <- school2building;
}
rm(new.building2school)
building2school.generate.new.school.id = function(schools, school2building){
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
sNewId <- schools$NEW_ID[sIdx];
for (s2bIdx in 1:nrow(school2building)) {
school2building$SCHOOL_NEW_ID[school2building$SCHOOL_NEW_ID == sId] <- sNewId;
}
print(paste(sIdx, " ", schools$NAME[sIdx], " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
};
building2school.generate.new.school.id <- school2building;
}
building2school_new <- building2school.generate.new.school.id(schools, school2building)
school2building$SCHOOL_NEW_ID <- school2building$SCHOOL_ID
building2school.generate.new.school.id = function(schools, school2building){
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
sNewId <- schools$NEW_ID[sIdx];
school2building$SCHOOL_NEW_ID[school2building$SCHOOL_NEW_ID == sId] <- sNewId;
print(paste(sIdx, " ", schools$NAME[sIdx], " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
};
building2school.generate.new.school.id <- school2building;
}
school2building$SCHOOL_NEW_ID <- school2building$SCHOOL_ID
building2school_new <- building2school.generate.new.school.id(schools, school2building)
View(building2school_new)
View(school2building)
View(school2building)
school2building <- building2school_new
rm(building2school_new)
school2building[school2building$SCHOOL_ID == 22]
subset(school2building, school2building$SCHOOL_ID == 22)
subset(school2building, SCHOOL_ID == 22)
school2building
subset(school2building, SCHOOL_ID == 19)
sbs<-subset(school2building, SCHOOL_ID == 19)
sbs
sbs$SCHOOL_NEW_ID <- 10058
sbs
rm(sbs)
building2school.new <-function(schools, school2building){
building2school.new <- data.frame();
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
sNewId <- schools$NEW_ID[sIdx];
school2building.subset <- subset(school2building, SCHOOL_ID == sId);
school2building.subset$SCHOOL_NEW_ID <- sNewId;
building2school.new <- rbind(building2school.new, school2building.subset);
print(paste(sIdx, " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
};
building2school.new;
}
school2building.new <- building2school.new(schools, school2building)
school2building.new <- building2school.new(schools, school2building)
debugSource('/media/WORK/hse/school-accessibility/r/generate_school_id.R')
school2building.new <- building2school.new(schools, school2building)
building2school.new <-function(schools, school2building){
building2school.new <- data.frame();
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
sNewId <- schools$NEW_ID[sIdx];
school2building.subset <- subset(school2building, SCHOOL_ID == sId);
if (length(school2building.subset) > 0) {
school2building.subset$SCHOOL_NEW_ID <- sNewId;
}
building2school.new <- rbind(building2school.new, school2building.subset);
print(paste(sIdx, " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
};
building2school.new;
}
school2building.new <- building2school.new(schools, school2building)
subset(school2building, SCHOOL_ID == 0)
length(subset(school2building, SCHOOL_ID == 0))
nrow(subset(school2building, SCHOOL_ID == 0))
building2school.new <-function(schools, school2building){
building2school.new <- data.frame();
for (sIdx in 1:nrow(schools)) {
sId <- schools$ID[sIdx];
sNewId <- schools$NEW_ID[sIdx];
school2building.subset <- subset(school2building, SCHOOL_ID == sId);
if (nrow(school2building.subset) > 0) {
school2building.subset$SCHOOL_NEW_ID <- sNewId;
}
building2school.new <- rbind(building2school.new, school2building.subset);
print(paste(sIdx, " ", round((100*sIdx)/nrow(schools), digits = 2), "%", sep = ""));
};
building2school.new;
}
school2building.new <- building2school.new(schools, school2building)
View(school2building.new)
school2building <- school2building.new
rm(school2building.new)
aggregate(school2building, SCHOOL_NEW_ID, HOUSE_ID, length)
aggregate(school2building, SCHOOL_NEW_ID ~ HOUSE_ID, length)
aggregate(SCHOOL_NEW_ID ~ HOUSE_ID, school2building, length)
agg <- aggregate(SCHOOL_NEW_ID ~ HOUSE_ID, school2building, length)
agg
View(agg)
agg <- aggregate(HOUSE_ID~SCHOOL_NEW_ID, school2building, length)
agg$HOUSE_ID_COUNT <- agg$HOUSE_ID;
agg
View(agg)
agg <- agg(c(1,3))
agg <- agg[c(1,3)]
View(agg)
schools.new <- merge(schools, agg, by=c("NEW_ID","SCHOOLS_NEW_ID"))
schools.new <- merge(schools, agg, by=c("NEW_ID","SCHOOL_NEW_ID"))
schools.new <- merge(schools, agg, by.x="NEW_ID", by.y="SCHOOL_NEW_ID")
View(schools.new)
schools.new <- merge(schools, agg, by.x="NEW_ID", by.y="SCHOOL_NEW_ID", all = TRUE)
View(schools.new)
schools.new$HOUSE_ID_COUNT[is.na(schools.new$HOUSE_ID_COUNT)] <- 0
View(schools.new)
schools.new <- schools.new[order(HOUSE_ID_COUNT)]
schools.new <- schools.new[order(HOUSE_ID_COUNT),]
View(schools.new)
schools.new <- schools.new[order(schools.new$HOUSE_ID_COUNT),]
View(schools.new)
schools.new[schools.new$HOUSE_ID_COUNT == 0]
subset(schools.new, HOUSE_ID_COUNT == 0)
schools.without.assigned.area <- subset(schools.new, HOUSE_ID_COUNT == 0 | HOUSE_ID_COUNT == 1)
View(schools.without.assigned.area)
schools.without.assigned.area <- schools.without.assigned.area[c[2,3,1,4,5,6,7,8,9,10,11]]
schools.without.assigned.area <- schools.without.assigned.area[c(2,3,1,4,5,6,7,8,9,10,11)]
rm(schools.new)
agg
rm(agg)
subset(schools, COMPLEX_ID == 499)
subset(schools, COMPLEX_ID == 499)$OBJECT_ID
subset(schools, COMPLEX_ID == 499)$OBJECTID
subset(schools.without.assigned.area, OBJECTID %in% subset(schools, COMPLEX_ID == 499)$OBJECTID)
subset(schools.without.assigned.area, OBJECTID %in% subset(schools, COMPLEX_ID == 499)$OBJECTID)$OBJECTID
save.image()
savehistory()
