schools.current.fill, school2building.economic, minSchoolStudents = 500) {
if (is.null(schools.current.fill)) {
schools.current.fill <- data.frame(ID = schools$ID, CURRENT_FILL = 0);
}
result.school.ids <- integer();
result.building.ids <- integer();
if (!is.null(school2building.economic)) {
result.school.ids <- school2building.economic$SCHOOL_ID;
result.building.ids <- school2building.economic$BUILDING_ID;
}
for (s2bIdx in 1:nrow(school2building.dist)) {
#    if (s2bIdx %% 100000 == 0) {
#      write.csv(data.frame(SCHOOL_ID = result.school.ids, BUILDING_ID = result.building.ids), "../csv/school2building-ecomomic.csv", row.names = FALSE);
#      write.csv(schools.current.fill, "../csv/schools-current-fill.csv", row.names = FALSE);
#    }
sId <- school2building.dist$SCHOOL_ID[s2bIdx];
bId <- school2building.dist$BUILDING_ID[s2bIdx];
if (bId %in% result.building.ids) {
next;
}
currentFill <- schools.current.fill[schools.current.fill$ID==sId,]$CURRENT_FILL;
if (currentFill >= minSchoolStudents) {
next;
}
result.school.ids <- c(result.school.ids, sId);
result.building.ids <- c(result.building.ids, bId);
students <- buildings[buildings$ID == bId,]$STUDENTS;
schools.current.fill[schools.current.fill$ID==sId,]$CURRENT_FILL <- currentFill + students;
print(paste(s2bIdx, " ", round((100*s2bIdx)/nrow(school2building.dist), digits = 2), "%", sep = ""));
}
school2building.economic <- data.frame(SCHOOL_ID = result.school.ids, BUILDING_ID = result.building.ids);
calc.school2building.economic <- list(schools.current.fill, school2building.economic);
calc.school2building.economic;
}
library("RMySQL", lib.loc="~/R/i686-pc-linux-gnu-library/3.0")
con <- dbConnect(MySQL(), user="root", password="Thisistheend", dbname="SCHOOL_ACCESSIBILITY", host="localhost")
rs <- dbSendQuery(con, "SELECT * FROM SCHOOL2BUILDING_DIST ORDER BY DIST LIMIT 1, 1000000;")
school2building.dist <- fetch(rs, n=1000000)
school2building.dist <- fetch(rs, n=1)
rs <- dbSendQuery(con, "SELECT * FROM SCHOOL2BUILDING_DIST ORDER BY DIST;")
dbHasCompleted(rs)
dbClearResult(rs)
dbDisconnect(con)
con <- dbConnect(MySQL(), user="root", password="Thisistheend", dbname="SCHOOL_ACCESSIBILITY", host="localhost")
rs <- dbSendQuery(con, "SELECT * FROM SCHOOL2BUILDING_DIST ORDER BY DIST;")
school2building.dist <- fetch(rs, n=1000000)
write.csv(school2building.dist, "/media/WORK/hse/school2building-ord-dist1.csv", row.names = FALSE)
school2building.dist <- fetch(rs, n=1000000)
rs <- dbSendQuery(con, "SELECT * FROM SCHOOL2BUILDING_DIST ORDER BY DIST;")
dbHasCompleted(rs)
dbClearResult(rs)
dbDisconnect(con)
school2building.dist <- read.csv("/media/WORK/hse/school2building-ord-dist1.csv", stringsAsFactors = FALSE)
school2building.economic <- calc.school2building.economic(buildings = buildings, schools = schools, school2building.dist = school2building.dist)
aa <- calc.school2building.economic(buildings, schools, school2building.dist)
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill = NULL, school2building.economic = NULL)
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill = NULL, school2building.economic = NULL, 500)
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill = NULL, school2building.economic = NULL, minSchoolStudents = 500)
debugSource('/media/WORK/hse/school-accessibility/r/school2building_dist.R')
debugSource('/media/WORK/hse/school-accessibility/r/school2building_dist.R')
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill = NULL, school2building.economic = NULL, minSchoolStudents = 500)
debugSource('/media/WORK/hse/school-accessibility/r/school2building_dist.R')
calc.school2building.economic <- function(buildings, schools, school2building.dist,
schools.current.fill, school2building.economic, minSchoolStudents = 500) {
if (is.null(schools.current.fill)) {
schools.current.fill <- data.frame(ID = schools$ID, CURRENT_FILL = 0);
}
result.school.ids <- integer();
result.building.ids <- integer();
if (!is.null(school2building.economic)) {
result.school.ids <- school2building.economic$SCHOOL_ID;
result.building.ids <- school2building.economic$BUILDING_ID;
}
for (s2bIdx in 1:nrow(school2building.dist)) {
#    if (s2bIdx %% 100000 == 0) {
#      write.csv(data.frame(SCHOOL_ID = result.school.ids, BUILDING_ID = result.building.ids), "../csv/school2building-ecomomic.csv", row.names = FALSE);
#      write.csv(schools.current.fill, "../csv/schools-current-fill.csv", row.names = FALSE);
#    }
sId <- school2building.dist$SCHOOL_ID[s2bIdx];
bId <- school2building.dist$BUILDING_ID[s2bIdx];
if (bId %in% result.building.ids) {
next;
}
currentFill <- schools.current.fill[schools.current.fill$ID==sId,]$CURRENT_FILL[1];
if (currentFill >= minSchoolStudents) {
next;
}
result.school.ids <- c(result.school.ids, sId);
result.building.ids <- c(result.building.ids, bId);
students <- buildings[buildings$ID == bId,]$STUDENTS;
schools.current.fill[schools.current.fill$ID==sId,]$CURRENT_FILL <- currentFill + students;
print(paste(s2bIdx, " ", round((100*s2bIdx)/nrow(school2building.dist), digits = 2), "%", sep = ""));
}
school2building.economic <- data.frame(SCHOOL_ID = result.school.ids, BUILDING_ID = result.building.ids);
calc.school2building.economic <- list(schools.current.fill, school2building.economic);
calc.school2building.economic;
}
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill = NULL, school2building.economic = NULL, minSchoolStudents = 500)
debugSource('/media/WORK/hse/school-accessibility/r/school2building_dist.R')
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill = NULL, school2building.economic = NULL, minSchoolStudents = 500)
schools.current.fill[schools.current.fill$ID==sId,]
View(schools.current.fill)
View(school2building.dist)
school2building.dist$S <- school2building.dist$BUILDING_ID
View(school2building.dist)
school2building.dist$BUILDING_ID <- school2building.dist$SCHOOL_ID
school2building.dist$SCHOOL_ID <- school2building.dist$S
school2building.dist$S <- NULL
save.image()
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill = NULL, school2building.economic = NULL, minSchoolStudents = 500)
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill = NULL, school2building.economic = NULL, minSchoolStudents = 500)
schools.current.fill <- aa[1,]
schools.current.fill <- aa[1]
schools.current.fill <- aa[[1]]
View(schools.current.fill)
school2building.economic <- aa[[2]]
View(school2building.economic)
rm(aa)
save.image()
con <- dbConnect(MySQL(), user="root", password="Thisistheend", dbname="SCHOOL_ACCESSIBILITY", host="localhost")
rs <- dbSendQuery(con, "SELECT * FROM SCHOOL2BUILDING_DIST ORDER BY DIST;")
school2building.dist <- fetch(rs, n=3000000)
write.csv(school2building.dist, "/media/WORK/hse/school2building-ord-dist3.csv", row.names = FALSE)
school2building.dist <- tail(school2building.dist, 2000000)
View(school2building.dist)
dbHasCompleted(rs);dbClearResult(rs);dbDisconnect(con);
school2building.dist1 <- head(school2building.dist, 1000000)
school2building.dist2 <- tail(school2building.dist, 1000000)
View(school2building.dist1)
View(school2building.dist2)
rm(school2building.dist)
save.image()
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill, school2building.economic, minSchoolStudents = 500)
aa <- calc.school2building.economic(buildings, schools, school2building.dist1, schools.current.fill, school2building.economic, minSchoolStudents = 500)
View(calc.school2building.economic)
calc.school2building.economic <- function(buildings, schools, school2building.dist,
schools.current.fill, school2building.economic, minSchoolStudents = 500) {
if (is.null(schools.current.fill)) {
schools.current.fill <- data.frame(ID = schools$ID, CURRENT_FILL = 0);
}
result.school.ids <- integer();
result.building.ids <- integer();
if (!is.null(school2building.economic)) {
result.school.ids <- school2building.economic$SCHOOL_ID;
result.building.ids <- school2building.economic$BUILDING_ID;
}
for (s2bIdx in 1:nrow(school2building.dist)) {
#    if (s2bIdx %% 100000 == 0) {
#      write.csv(data.frame(SCHOOL_ID = result.school.ids, BUILDING_ID = result.building.ids), "../csv/school2building-ecomomic.csv", row.names = FALSE);
#      write.csv(schools.current.fill, "../csv/schools-current-fill.csv", row.names = FALSE);
#    }
sId <- school2building.dist$SCHOOL_ID[s2bIdx];
bId <- school2building.dist$BUILDING_ID[s2bIdx];
if (bId %in% result.building.ids) {
next;
}
currentFill <- schools.current.fill[schools.current.fill$ID==sId,]$CURRENT_FILL[1];
if (currentFill >= minSchoolStudents) {
next;
}
result.school.ids <- c(result.school.ids, sId);
result.building.ids <- c(result.building.ids, bId);
students <- buildings[buildings$ID == bId,]$STUDENTS;
schools.current.fill[schools.current.fill$ID==sId,]$CURRENT_FILL <- currentFill + students;
print(paste(s2bIdx, " ", round((100*s2bIdx)/nrow(school2building.dist), digits = 2), "%", sep = ""));
}
school2building.economic <- data.frame(SCHOOL_ID = result.school.ids, BUILDING_ID = result.building.ids);
calc.school2building.economic <- list(schools.current.fill, school2building.economic);
calc.school2building.economic;
}
aa <- calc.school2building.economic(buildings, schools, school2building.dist1, schools.current.fill, school2building.economic, minSchoolStudents = 500)
debugSource('/media/WORK/hse/school-accessibility/r/school2building_dist.R')
aa <- calc.school2building.economic(buildings, schools, school2building.dist1, schools.current.fill, school2building.economic, minSchoolStudents = 500)
school2building.dist1$S <- school2building.dist1$BUILDING_ID
school2building.dist1$BUILDING_ID <- school2building.dist1$SCHOOL_ID
school2building.dist1$SCHOOL_ID <- school2building.dist1$S
school2building.dist1$S <- NULL
school2building.dist2$S <- school2building.dist2$BUILDING_ID
school2building.dist2$BUILDING_ID <- school2building.dist2$SCHOOL_ID
school2building.dist2$SCHOOL_ID <- school2building.dist2$S
school2building.dist2$S <- NULL
View(school2building.dist1)
View(school2building.dist2)
save.image()
aa <- calc.school2building.economic(buildings, schools, school2building.dist1, schools.current.fill, school2building.economic, minSchoolStudents = 500)
aa <- calc.school2building.economic(buildings, schools, school2building.dist1, schools.current.fill, school2building.economic, minSchoolStudents = 500)
schools.current.fill1 <- aa[[1]]
school2building.economic1 <- aa[[2]]
View(schools.current.fill)
View(schools.current.fill1)
View(schools.current.fill)
schools.current.fill[schools.current.fill$CURRENT_FILL < 500, ]
nrow(schools.current.fill[schools.current.fill$CURRENT_FILL < 500, ])
nrow(schools.current.fill[schools.current.fill1$CURRENT_FILL < 500, ])
schools.current.fill1[schools.current.fill1$CURRENT_FILL < 500, ]
school2building.economic <- school2building.economic1
schools.current.fill <- schools.current.fill1
rm(schools.current.fill1, school2building.economic1,aa)
aa <- calc.school2building.economic(buildings, schools, school2building.dist2, schools.current.fill, school2building.economic, minSchoolStudents = 500)
schools.current.fill1 <- aa[[1]]
school2building.economic1 <- aa[[2]]
schools.current.fill1[schools.current.fill1$CURRENT_FILL < 500, ]
nrow(schools.current.fill[schools.current.fill1$CURRENT_FILL < 500, ])
schools.current.fill <- schools.current.fill1
school2building.economic <- school2building.economic1
rm(aa, school2building.economic1,schools.current.fill1)
rm(school2building.dist1,school2building.dist2)
save.image()
con <- dbConnect(MySQL(), user="root", password="Thisistheend", dbname="SCHOOL_ACCESSIBILITY", host="localhost")
rs <- dbSendQuery(con, "SELECT * FROM SCHOOL2BUILDING_DIST ORDER BY DIST;")
school2building.dist <- fetch(rs, n=6000000)
write.csv(school2building.dist, "/media/WORK/hse/school2building-ord-dist6.csv", row.names = FALSE)
school2building.dist <- tail(school2building.dist, 3000000)
dbHasCompleted(rs);dbClearResult(rs);dbDisconnect(con);
school2building.dist1 <- head(school2building.dist, 1000000)
school2building.dist3 <- tail(school2building.dist, 1000000)
school2building.dist2 <- head(tail(school2building.dist, 2000000),1000000)
View(school2building.dist1)
View(school2building.dist2)
View(school2building.dist3)
rm(school2building.dist)
school2building.dist1$S <- school2building.dist1$BUILDING_ID
school2building.dist1$BUILDING_ID <- school2building.dist1$SCHOOL_ID
school2building.dist1$SCHOOL_ID <- school2building.dist1$S
school2building.dist1$S <- NULL
school2building.dist2$S <- school2building.dist2$BUILDING_ID
school2building.dist2$BUILDING_ID <- school2building.dist2$SCHOOL_ID
school2building.dist2$SCHOOL_ID <- school2building.dist2$S
school2building.dist2$S <- NULL
school2building.dist3$S <- school2building.dist3$BUILDING_ID
school2building.dist3$BUILDING_ID <- school2building.dist3$SCHOOL_ID
school2building.dist3$SCHOOL_ID <- school2building.dist3$S
school2building.dist3$S <- NULL
View(school2building.dist1)
View(school2building.dist2)
View(school2building.dist3)
save.image()
aa <- calc.school2building.economic(buildings, schools, school2building.dist2, schools.current.fill, school2building.economic, minSchoolStudents = 500)
aa <- calc.school2building.economic(buildings, schools, school2building.dist1, schools.current.fill, school2building.economic, minSchoolStudents = 500)
school2building.dist2 <- rbind(school2building.dist2, school2building.dist3)
rm(school2building.dist3)
schools.current.fill1 <- aa[[1]]
school2building.economic1 <- aa[[2]]
schools.current.fill1[schools.current.fill1$CURRENT_FILL < 500, ]
nrow(schools.current.fill[schools.current.fill1$CURRENT_FILL < 500, ])
schools.current.fill <- schools.current.fill1
school2building.economic <- school2building.economic1
rm(schools.current.fill1, school2building.economic1,aa)
save.image()
aa <- calc.school2building.economic(buildings, schools, school2building.dist2, schools.current.fill, school2building.economic, minSchoolStudents = 500)
rm(aa)
rm(school2building.dist1, school2building.dist2)
rm(school2building.economic, schools.current.fill)
save.image()
school2building.dist1 <- read.csv("/media/WORK/hse/school2building-ord-dist1.csv", stringsAsFactors = FALSE)
school2building.dist3 <- read.csv("/media/WORK/hse/school2building-ord-dist3.csv", stringsAsFactors = FALSE)
school2building.dist6 <- read.csv("/media/WORK/hse/school2building-ord-dist6.csv", stringsAsFactors = FALSE)
school2building.dist <- rbind(school2building.dist1, school2building.dist3, school2building.dist6)
rm(school2building.dist1,school2building.dist3,school2building.dist6)
school2building.dist$ORD <- c[1:10000000]
a <- c[1:10000000]
rownames(school2building.dist)[5]
school2building.dist$ORD <- rownames(school2building.dist)
calc.school2building.economic <- function(buildings, schools, school2building.dist,
schools.current.fill, school2building.economic, minSchoolStudents = 500) {
if (is.null(schools.current.fill)) {
schools.current.fill <- data.frame(ID = schools$ID, CURRENT_FILL = 0);
}
result.school.ids <- integer();
result.building.ids <- integer();
if (!is.null(school2building.economic)) {
result.school.ids <- school2building.economic$SCHOOL_ID;
result.building.ids <- school2building.economic$BUILDING_ID;
}
#  for (s2bIdx in 1:nrow(school2building.dist)) {
while (nrow(school2building.dist) != 0) {
#    if (s2bIdx %% 100000 == 0) {
#      write.csv(data.frame(SCHOOL_ID = result.school.ids, BUILDING_ID = result.building.ids), "../csv/school2building-ecomomic.csv", row.names = FALSE);
#      write.csv(schools.current.fill, "../csv/schools-current-fill.csv", row.names = FALSE);
#    }
sId <- school2building.dist$SCHOOL_ID[1];
bId <- school2building.dist$BUILDING_ID[1];
if (bId %in% result.building.ids) {
next;
}
currentFill <- schools.current.fill[schools.current.fill$ID==sId,]$CURRENT_FILL[1];
if (currentFill >= minSchoolStudents) {
next;
}
result.school.ids <- c(result.school.ids, sId);
result.building.ids <- c(result.building.ids, bId);
school2building.dist <- school2building.dist[school2building.dist != bId];
students <- buildings[buildings$ID == bId,]$STUDENTS;
schools.current.fill[schools.current.fill$ID==sId,]$CURRENT_FILL <- currentFill + students;
print(paste(s2bIdx, " ", round((100*s2bIdx)/nrow(school2building.dist), digits = 2), "%", sep = ""));
}
school2building.economic <- data.frame(SCHOOL_ID = result.school.ids, BUILDING_ID = result.building.ids);
calc.school2building.economic <- list(schools.current.fill, school2building.economic);
calc.school2building.economic;
}
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill, school2building.economic, minSchoolStudents = 500)
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill = NULL, school2building.economic = NULL, minSchoolStudents = 500)
calc.school2building.economic <- function(buildings, schools, school2building.dist,
schools.current.fill, school2building.economic, minSchoolStudents = 500) {
if (is.null(schools.current.fill)) {
schools.current.fill <- data.frame(ID = schools$ID, CURRENT_FILL = 0);
}
result.school.ids <- integer();
result.building.ids <- integer();
if (!is.null(school2building.economic)) {
result.school.ids <- school2building.economic$SCHOOL_ID;
result.building.ids <- school2building.economic$BUILDING_ID;
}
#  for (s2bIdx in 1:nrow(school2building.dist)) {
while (nrow(school2building.dist) != 0) {
#    if (s2bIdx %% 100000 == 0) {
#      write.csv(data.frame(SCHOOL_ID = result.school.ids, BUILDING_ID = result.building.ids), "../csv/school2building-ecomomic.csv", row.names = FALSE);
#      write.csv(schools.current.fill, "../csv/schools-current-fill.csv", row.names = FALSE);
#    }
sId <- school2building.dist$SCHOOL_ID[1];
bId <- school2building.dist$BUILDING_ID[1];
if (bId %in% result.building.ids) {
next;
}
currentFill <- schools.current.fill[schools.current.fill$ID==sId,]$CURRENT_FILL[1];
if (currentFill >= minSchoolStudents) {
next;
}
result.school.ids <- c(result.school.ids, sId);
result.building.ids <- c(result.building.ids, bId);
school2building.dist <- school2building.dist[school2building.dist != bId];
students <- buildings[buildings$ID == bId,]$STUDENTS;
schools.current.fill[schools.current.fill$ID==sId,]$CURRENT_FILL <- currentFill + students;
print(nrow(school2building.dist));
#    print(paste(s2bIdx, " ", round((100*s2bIdx)/nrow(school2building.dist), digits = 2), "%", sep = ""));
}
school2building.economic <- data.frame(SCHOOL_ID = result.school.ids, BUILDING_ID = result.building.ids);
calc.school2building.economic <- list(schools.current.fill, school2building.economic);
calc.school2building.economic;
}
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill = NULL, school2building.economic = NULL, minSchoolStudents = 500)
calc.school2building.economic <- function(buildings, schools, school2building.dist,
schools.current.fill, school2building.economic, minSchoolStudents = 500) {
if (is.null(schools.current.fill)) {
schools.current.fill <- data.frame(ID = schools$ID, CURRENT_FILL = 0);
}
result.school.ids <- integer();
result.building.ids <- integer();
if (!is.null(school2building.economic)) {
result.school.ids <- school2building.economic$SCHOOL_ID;
result.building.ids <- school2building.economic$BUILDING_ID;
}
for (s2bIdx in 1:nrow(school2building.dist)) {
#    if (s2bIdx %% 100000 == 0) {
#      write.csv(data.frame(SCHOOL_ID = result.school.ids, BUILDING_ID = result.building.ids), "../csv/school2building-ecomomic.csv", row.names = FALSE);
#      write.csv(schools.current.fill, "../csv/schools-current-fill.csv", row.names = FALSE);
#    }
sId <- school2building.dist$SCHOOL_ID[s2bIdx];
bId <- school2building.dist$BUILDING_ID[s2bIdx];
if (bId %in% result.building.ids) {
next;
}
currentFill <- schools.current.fill[schools.current.fill$ID==sId,]$CURRENT_FILL[1];
if (currentFill >= minSchoolStudents) {
next;
}
result.school.ids <- c(result.school.ids, sId);
result.building.ids <- c(result.building.ids, bId);
students <- buildings[buildings$ID == bId,]$STUDENTS;
schools.current.fill[schools.current.fill$ID==sId,]$CURRENT_FILL <- currentFill + students;
print(paste(s2bIdx, " ", round((100*s2bIdx)/nrow(school2building.dist), digits = 2), "%", sep = ""));
}
school2building.economic <- data.frame(SCHOOL_ID = result.school.ids, BUILDING_ID = result.building.ids);
calc.school2building.economic <- list(schools.current.fill, school2building.economic);
calc.school2building.economic;
}
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill = NULL, school2building.economic = NULL, minSchoolStudents = 500)
school2building.dist <- read.csv("/media/WORK/hse/school2building-ord-dist6.csv", stringsAsFactors = FALSE)
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill = NULL, school2building.economic = NULL, minSchoolStudents = 500)
schools.current.fill <- aa[[1]]
school2building.economic <- aa[[2]]
schools.current.fill[schools.current.fill$CURRENT_FILL < 500,]
rm(school2building.dist, aa)
save.image()
con <- dbConnect(MySQL(), user="root", password="Thisistheend", dbname="SCHOOL_ACCESSIBILITY", host="localhost")
rs <- dbSendQuery(con, "SELECT * FROM SCHOOL2BUILDING_DIST ORDER BY DIST;")
fetch(rs, n=6000000)
school2building.dist <- fetch(rs, n=4000000)
write.csv(school2building.dist, "/media/WORK/hse/school2building-ord-dist10.csv", row.names = FALSE)
school2building.dist$ORD <- c[1:4000000]
school2building.dist$ORD <- rownames(school2building.dist)
school2building.dist$S <- school2building.dist$BUILDING_ID
school2building.dist$BUILDING_ID <- school2building.dist$SCHOOL_ID
school2building.dist$SCHOOL_ID <- school2building.dist$S
school2building.dist$S <- NULL
schools.current.fill[schools.current.fill$CURRENT_FILL < 500,]$SCHOOL_ID
schools.current.fill[schools.current.fill$CURRENT_FILL < 500,]
schools.current.fill[schools.current.fill$CURRENT_FILL < 500,]$ID
school2building.dist1 <- school2building.dist[school2building.dist$SCHOOL_ID %in% schools.current.fill[schools.current.fill$CURRENT_FILL < 500,]$ID,]
school2building.dist <- school2building.dist[school2building.dist$SCHOOL_ID %in% schools.current.fill[schools.current.fill$CURRENT_FILL < 500,]$ID,]
rm(school2building.dist1)
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill, school2building.economic, minSchoolStudents = 500)
View(school2building.dist)
schools.current.fill1 <- aa[[1]]
school2building.economic1 <- aa[[2]]
schools.current.fill1[schools.current.fill1$CURRENT_FILL < 500,]
schools.current.fill <- aa[[1]]
school2building.economic <- aa[[2]]
rm(schools.current.fill1, school2building.economic1,aa)
save.image()
school2building.dist <- fetch(rs, n=4000000)
dbHasCompleted(rs);dbClearResult(rs);dbDisconnect(con);
con <- dbConnect(MySQL(), user="root", password="Thisistheend", dbname="SCHOOL_ACCESSIBILITY", host="localhost")
schools.current.fill[schools.current.fill$CURRENT_FILL < 500,]
schools.current.fill[schools.current.fill$CURRENT_FILL < 500,]$ID
rs <- dbSendQuery(con, "SELECT * FROM SCHOOL2BUILDING_DIST WHERE BUILDING_ID IN (10118,10208,10209,10210,10211,10368,10480,10532,10618,10749,10837,10843,10984,10985,10986,10987,11021,11091,11170) AND DIST > 9287 ORDER BY DIST;")
school2building.dist <- fetch(rs, n=662394)
dbHasCompleted(rs);dbClearResult(rs);dbDisconnect(con);
View(school2building.dist)
school2building.dist$S <- school2building.dist$BUILDING_ID
school2building.dist$BUILDING_ID <- school2building.dist$SCHOOL_ID
school2building.dist$SCHOOL_ID <- school2building.dist$S
school2building.dist$S <- NULL
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill, school2building.economic, minSchoolStudents = 500)
View(school2building.economic)
school2building.dist1 <- school2building.dist[!school2building.dist$BUILDING_ID %in% school2building.economic$BUILDING_ID,]
View(school2building.dist1)
school2building.economic[school2building.economic$BUILDING_ID == 10447,]
school2building.dist <- school2building.dist[!school2building.dist$BUILDING_ID %in% school2building.economic$BUILDING_ID,]
aa <- calc.school2building.economic(buildings, schools, school2building.dist, schools.current.fill, school2building.economic, minSchoolStudents = 500)
View(school2building.dist)
schools.current.fill1 <- aa[[1]]
school2building.economic1 <- aa[[2]]
schools.current.fill1[schools.current.fill1$CURRENT_FILL < 500,]
schools.current.fill <- aa[[1]]
school2building.economic <- aa[[2]]
save.image()
rm(schools.current.fill1, school2building.economic1)
rm(school2building.dist1)
save.image()
schools.current.fill <- schools.current.fill[order(schools.current.fill$CURRENT_FILL),]
View(schools.current.fill)
rm(schools.current.fill, school2building.dist)
save.image()
dbHasCompleted(rs);dbClearResult(rs);dbDisconnect(con);
con <- dbConnect(MySQL(), user="root", password="Thisistheend", dbname="SCHOOL_ACCESSIBILITY", host="localhost")
rs <- dbSendQuery(con, "SELECT * FROM SCHOOL2BUILDING_DIST WHERE DIST <= 500;")
school2building.r500 <- fetch(rs, n=68190)
rs <- dbSendQuery(con, "SELECT * FROM SCHOOL2BUILDING_DIST WHERE DIST <= 500;")
dbHasCompleted(rs);dbClearResult(rs);dbDisconnect(con);
con <- dbConnect(MySQL(), user="root", password="Thisistheend", dbname="SCHOOL_ACCESSIBILITY", host="localhost")
rs <- dbSendQuery(con, "SELECT * FROM SCHOOL2BUILDING_DIST WHERE DIST <= 500;")
school2building.r500 <- fetch(rs, n=68190)
school2building.r500$S <- school2building.r500$BUILDING_ID
school2building.r500$BUILDING_ID <- school2building.r500$SCHOOL_ID
school2building.r500$SCHOOL_ID <- school2building.r500$S
school2building.r500$S <- NULL
View(school2building.r500)
save.image()
rm(aa)
save.image()
dbHasCompleted(rs);dbClearResult(rs);dbDisconnect(con);
con <- dbConnect(MySQL(), user="root", password="Thisistheend", dbname="SCHOOL_ACCESSIBILITY", host="localhost")
rs <- dbSendQuery(con, "SELECT * FROM SCHOOL2BUILDING_DIST WHERE DIST <= 800;")
school2building.r800 <- fetch(rs, n=149226)
school2building.r800$S <- school2building.r800$BUILDING_ID
school2building.r800$BUILDING_ID <- school2building.r800$SCHOOL_ID
school2building.r800$SCHOOL_ID <- school2building.r800$S
school2building.r800$S <- NULL
save.image()
dbHasCompleted(rs);dbClearResult(rs);dbDisconnect(con);
con <- dbConnect(MySQL(), user="root", password="Thisistheend", dbname="SCHOOL_ACCESSIBILITY", host="localhost")
rs <- dbSendQuery(con, "SELECT * FROM SCHOOL2BUILDING_DIST WHERE DIST <= 1000;")
school2building.r1000 <- fetch(rs, n=215812)
dbHasCompleted(rs);dbClearResult(rs);dbDisconnect(con);
school2building.r1000$S <- school2building.r1000$BUILDING_ID
school2building.r1000$BUILDING_ID <- school2building.r1000$SCHOOL_ID
school2building.r1000$SCHOOL_ID <- school2building.r1000$S
school2building.r1000$S <- NULL
save.image()
rm(con, rs)
rm(calc.dist.for.school2building, calc.school2building.economic)
save.image()
savehistory()
write.csv(school2building.economic, "../csv/school2building-economic.csv", row.names = FALSE, na = "")
write.csv(school2building.r500, "../csv/school2building-r500.csv", row.names = FALSE, na = "")
write.csv(school2building.r800, "../csv/school2building-r800.csv", row.names = FALSE, na = "")
write.csv(school2building.r1000, "../csv/school2building-r1000.csv", row.names = FALSE, na = "")
save.image()
features.area.economic <- generate.area.features(buildings, schools, school.blocks, school2building.economic)
save.image()
school2building.r500 <- school2building.r500[c(2,1,3)]
school2building.r800 <- school2building.r800[c(2,1,3)]
school2building.r1000 <- school2building.r1000[c(2,1,3)]
save.image()
write.csv(school2building.r500, "../csv/school2building-r500.csv", row.names = FALSE, na = "")
write.csv(school2building.r800, "../csv/school2building-r800.csv", row.names = FALSE, na = "")
write.csv(school2building.r1000, "../csv/school2building-r1000.csv", row.names = FALSE, na = "")
features.connection.economic <- generate.connection.features(buildings, schools, school.blocks, school2building.economic)
save.image()
write.csv(features.area.economic, "../csv/features.area.economic.csv", row.names = FALSE)
write.csv(features.connection.economic, "../csv/features.connection.economic.csv", row.names = FALSE)
features.connection.r500 <- generate.connection.features(buildings, schools, school.blocks, school2building.r500)
write.csv(features.connection.r500, "../csv/features.connection.r500.csv", row.names = FALSE)
save.image()
features.connection.r800 <- generate.connection.features(buildings, schools, school.blocks, school2building.r800)
write.csv(features.connection.r800, "../csv/features.connection.r800.csv", row.names = FALSE)
save.image()
features.connection.r1000 <- generate.connection.features(buildings, schools, school.blocks, school2building.r1000)
write.csv(features.connection.r1000, "../csv/features.connection.r1000.csv", row.names = FALSE)
save.image()
savehistory()
